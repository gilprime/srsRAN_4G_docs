<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.8.17">
  <compounddef id="ra__scheduler_8cpp" kind="file" language="C++">
    <compoundname>ra_scheduler.cpp</compoundname>
    <includes refid="ra__scheduler_8h" local="yes">ra_scheduler.h</includes>
    <includes refid="gnb__format_8h" local="yes">../../ran/gnb_format.h</includes>
    <includes refid="pdcch__config__helpers_8h" local="yes">../pdcch_scheduling/pdcch_config_helpers.h</includes>
    <includes refid="pdcch__scheduler__impl_8h" local="yes">../pdcch_scheduling/pdcch_scheduler_impl.h</includes>
    <includes refid="config__helpers_8h" local="yes">../support/config_helpers.h</includes>
    <includes refid="dmrs__helpers_8h" local="yes">../support/dmrs_helpers.h</includes>
    <includes refid="resource__allocation__frequency_8h" local="yes">srsgnb/ran/resource_allocation/resource_allocation_frequency.h</includes>
    <incdepgraph>
      <node id="49">
        <label>atomic</label>
      </node>
      <node id="96">
        <label>srsgnb/ran/lcid.h</label>
        <link refid="lcid_8h_source"/>
        <childnode refid="12" relation="include">
        </childnode>
      </node>
      <node id="56">
        <label>srsgnb/ran/resource_allocation/rb_interval.h</label>
        <link refid="rb__interval_8h_source"/>
        <childnode refid="57" relation="include">
        </childnode>
      </node>
      <node id="7">
        <label>srsgnb/adt/bounded_bitset.h</label>
        <link refid="bounded__bitset_8h_source"/>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="25" relation="include">
        </childnode>
        <childnode refid="28" relation="include">
        </childnode>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="50" relation="include">
        </childnode>
        <childnode refid="22" relation="include">
        </childnode>
      </node>
      <node id="59">
        <label>subcarrier_spacing.h</label>
        <link refid="subcarrier__spacing_8h_source"/>
        <childnode refid="60" relation="include">
        </childnode>
        <childnode refid="28" relation="include">
        </childnode>
      </node>
      <node id="74">
        <label>system_error</label>
      </node>
      <node id="20">
        <label>functional</label>
      </node>
      <node id="64">
        <label>srsgnb/ran/frame_types.h</label>
        <link refid="frame__types_8h_source"/>
        <childnode refid="46" relation="include">
        </childnode>
      </node>
      <node id="13">
        <label>limits</label>
      </node>
      <node id="117">
        <label>srsgnb/ran/pdcch/cce_to_prb_mapping.h</label>
        <link refid="cce__to__prb__mapping_8h_source"/>
        <childnode refid="7" relation="include">
        </childnode>
        <childnode refid="92" relation="include">
        </childnode>
        <childnode refid="80" relation="include">
        </childnode>
        <childnode refid="66" relation="include">
        </childnode>
        <childnode refid="67" relation="include">
        </childnode>
      </node>
      <node id="111">
        <label>srsgnb/ran/duplex_mode.h</label>
        <link refid="duplex__mode_8h_source"/>
      </node>
      <node id="21">
        <label>iterator</label>
      </node>
      <node id="93">
        <label>srsgnb/adt/circular_array.h</label>
        <link refid="circular__array_8h"/>
        <childnode refid="17" relation="include">
        </childnode>
        <childnode refid="46" relation="include">
        </childnode>
      </node>
      <node id="12">
        <label>cstdint</label>
      </node>
      <node id="42">
        <label>srsgnb/srslog/detail/support/memory_buffer.h</label>
        <link refid="memory__buffer_8h_source"/>
        <childnode refid="22" relation="include">
        </childnode>
      </node>
      <node id="78">
        <label>stdint.h</label>
      </node>
      <node id="69">
        <label>srsgnb/ran/prach/restricted_set_config.h</label>
        <link refid="restricted__set__config_8h_source"/>
      </node>
      <node id="71">
        <label>../support/rb_find_algorithm.h</label>
        <link refid="rb__find__algorithm_8h_source"/>
        <childnode refid="54" relation="include">
        </childnode>
      </node>
      <node id="121">
        <label>srsgnb/support/error_handling.h</label>
        <link refid="error__handling_8h_source"/>
        <childnode refid="29" relation="include">
        </childnode>
      </node>
      <node id="76">
        <label>srsgnb/ran/carrier_configuration.h</label>
        <link refid="carrier__configuration_8h_source"/>
        <childnode refid="77" relation="include">
        </childnode>
        <childnode refid="12" relation="include">
        </childnode>
      </node>
      <node id="99">
        <label>scheduler_slot_handler.h</label>
        <link refid="scheduler__slot__handler_8h_source"/>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="54" relation="include">
        </childnode>
        <childnode refid="100" relation="include">
        </childnode>
        <childnode refid="89" relation="include">
        </childnode>
        <childnode refid="92" relation="include">
        </childnode>
        <childnode refid="79" relation="include">
        </childnode>
        <childnode refid="96" relation="include">
        </childnode>
        <childnode refid="101" relation="include">
        </childnode>
        <childnode refid="65" relation="include">
        </childnode>
        <childnode refid="80" relation="include">
        </childnode>
        <childnode refid="102" relation="include">
        </childnode>
        <childnode refid="104" relation="include">
        </childnode>
        <childnode refid="82" relation="include">
        </childnode>
        <childnode refid="84" relation="include">
        </childnode>
        <childnode refid="59" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="46" relation="include">
        </childnode>
      </node>
      <node id="11">
        <label>cmath</label>
      </node>
      <node id="48">
        <label>cassert</label>
      </node>
      <node id="52">
        <label>detail/type_storage.h</label>
        <link refid="type__storage_8h_source"/>
        <childnode refid="46" relation="include">
        </childnode>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="23" relation="include">
        </childnode>
        <childnode refid="53" relation="include">
        </childnode>
      </node>
      <node id="15">
        <label>stdexcept</label>
      </node>
      <node id="44">
        <label>srsgnb/srslog/context.h</label>
        <link refid="context_8h_source"/>
        <childnode refid="45" relation="include">
        </childnode>
        <childnode refid="48" relation="include">
        </childnode>
        <childnode refid="22" relation="include">
        </childnode>
      </node>
      <node id="75">
        <label>srsgnb/scheduler/scheduler_configurator.h</label>
        <link refid="scheduler__configurator_8h_source"/>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="51" relation="include">
        </childnode>
        <childnode refid="76" relation="include">
        </childnode>
        <childnode refid="79" relation="include">
        </childnode>
        <childnode refid="80" relation="include">
        </childnode>
        <childnode refid="81" relation="include">
        </childnode>
        <childnode refid="82" relation="include">
        </childnode>
        <childnode refid="83" relation="include">
        </childnode>
        <childnode refid="84" relation="include">
        </childnode>
        <childnode refid="85" relation="include">
        </childnode>
        <childnode refid="59" relation="include">
        </childnode>
        <childnode refid="88" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="89" relation="include">
        </childnode>
      </node>
      <node id="3">
        <label>../cell/resource_grid.h</label>
        <link refid="lib_2scheduler_2cell_2resource__grid_8h_source"/>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="71" relation="include">
        </childnode>
        <childnode refid="72" relation="include">
        </childnode>
        <childnode refid="93" relation="include">
        </childnode>
        <childnode refid="84" relation="include">
        </childnode>
        <childnode refid="94" relation="include">
        </childnode>
      </node>
      <node id="22">
        <label>string</label>
      </node>
      <node id="6">
        <label>dmrs.h</label>
        <link refid="dmrs_8h_source"/>
        <childnode refid="7" relation="include">
        </childnode>
        <childnode refid="51" relation="include">
        </childnode>
      </node>
      <node id="28">
        <label>srsgnb_assert.h</label>
        <link refid="srsgnb__assert_8h_source"/>
        <childnode refid="29" relation="include">
        </childnode>
        <childnode refid="18" relation="include">
        </childnode>
      </node>
      <node id="101">
        <label>srsgnb/ran/modulation_scheme.h</label>
        <link refid="modulation__scheme_8h"/>
        <childnode refid="22" relation="include">
        </childnode>
      </node>
      <node id="105">
        <label>../pdcch_scheduling/pdcch_scheduler.h</label>
        <link refid="pdcch__scheduler_8h_source"/>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="106" relation="include">
        </childnode>
        <childnode refid="99" relation="include">
        </childnode>
      </node>
      <node id="86">
        <label>srsgnb/ran/ssb_properties.h</label>
        <link refid="ssb__properties_8h_source"/>
        <childnode refid="87" relation="include">
        </childnode>
        <childnode refid="59" relation="include">
        </childnode>
      </node>
      <node id="83">
        <label>srsgnb/ran/sib_configuration.h</label>
        <link refid="sib__configuration_8h_source"/>
      </node>
      <node id="41">
        <label>srsgnb/srslog/detail/support/error_string.h</label>
        <link refid="error__string_8h_source"/>
        <childnode refid="22" relation="include">
        </childnode>
      </node>
      <node id="109">
        <label>../ue_scheduling/harq_process.h</label>
        <link refid="harq__process_8h_source"/>
        <childnode refid="92" relation="include">
        </childnode>
        <childnode refid="82" relation="include">
        </childnode>
        <childnode refid="84" relation="include">
        </childnode>
        <childnode refid="100" relation="include">
        </childnode>
        <childnode refid="89" relation="include">
        </childnode>
        <childnode refid="17" relation="include">
        </childnode>
      </node>
      <node id="82">
        <label>srsgnb/ran/rnti.h</label>
        <link refid="rnti_8h_source"/>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="23" relation="include">
        </childnode>
      </node>
      <node id="72">
        <label>cell_configuration.h</label>
        <link refid="lib_2scheduler_2cell_2cell__configuration_8h_source"/>
        <childnode refid="73" relation="include">
        </childnode>
        <childnode refid="75" relation="include">
        </childnode>
      </node>
      <node id="104">
        <label>srsgnb/ran/prach/prach_preamble_format.h</label>
        <link refid="prach__preamble__format_8h_source"/>
      </node>
      <node id="8">
        <label>srsgnb/srslog/bundled/fmt/format.h</label>
        <link refid="format_8h_source"/>
        <childnode refid="9" relation="include">
        </childnode>
        <childnode refid="10" relation="include">
        </childnode>
        <childnode refid="11" relation="include">
        </childnode>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="13" relation="include">
        </childnode>
        <childnode refid="14" relation="include">
        </childnode>
        <childnode refid="15" relation="include">
        </childnode>
        <childnode refid="16" relation="include">
        </childnode>
      </node>
      <node id="85">
        <label>srsgnb/ran/ssb_configuration.h</label>
        <link refid="ssb__configuration_8h_source"/>
        <childnode refid="86" relation="include">
        </childnode>
        <childnode refid="59" relation="include">
        </childnode>
      </node>
      <node id="68">
        <label>srsgnb/phy/constants.h</label>
        <link refid="constants_8h_source"/>
      </node>
      <node id="54">
        <label>prb_grant.h</label>
        <link refid="prb__grant_8h_source"/>
        <childnode refid="55" relation="include">
        </childnode>
        <childnode refid="7" relation="include">
        </childnode>
        <childnode refid="56" relation="include">
        </childnode>
        <childnode refid="58" relation="include">
        </childnode>
        <childnode refid="61" relation="include">
        </childnode>
      </node>
      <node id="88">
        <label>srsgnb/ran/tdd_ul_dl_config.h</label>
        <link refid="tdd__ul__dl__config_8h_source"/>
      </node>
      <node id="84">
        <label>srsgnb/ran/slot_point.h</label>
        <link refid="slot__point_8h_source"/>
        <childnode refid="57" relation="include">
        </childnode>
        <childnode refid="28" relation="include">
        </childnode>
      </node>
      <node id="66">
        <label>srsgnb/ran/pdcch/coreset.h</label>
        <link refid="coreset_8h_source"/>
        <childnode refid="7" relation="include">
        </childnode>
        <childnode refid="51" relation="include">
        </childnode>
        <childnode refid="67" relation="include">
        </childnode>
        <childnode refid="56" relation="include">
        </childnode>
      </node>
      <node id="102">
        <label>srsgnb/ran/pdsch/pdsch_mcs.h</label>
        <link refid="pdsch__mcs_8h_source"/>
        <childnode refid="103" relation="include">
        </childnode>
      </node>
      <node id="94">
        <label>srsgnb/scheduler/mac_scheduler.h</label>
        <link refid="mac__scheduler_8h_source"/>
        <childnode refid="75" relation="include">
        </childnode>
        <childnode refid="95" relation="include">
        </childnode>
        <childnode refid="97" relation="include">
        </childnode>
        <childnode refid="99" relation="include">
        </childnode>
      </node>
      <node id="35">
        <label>srsgnb/srslog/detail/log_entry.h</label>
        <link refid="log__entry_8h_source"/>
        <childnode refid="36" relation="include">
        </childnode>
        <childnode refid="38" relation="include">
        </childnode>
      </node>
      <node id="95">
        <label>scheduler_dl_buffer_state_indicator.h</label>
        <link refid="scheduler__dl__buffer__state__indicator_8h_source"/>
        <childnode refid="79" relation="include">
        </childnode>
        <childnode refid="96" relation="include">
        </childnode>
      </node>
      <node id="34">
        <label>srsgnb/srslog/shared_types.h</label>
        <link refid="shared__types_8h_source"/>
        <childnode refid="20" relation="include">
        </childnode>
        <childnode refid="22" relation="include">
        </childnode>
      </node>
      <node id="40">
        <label>srsgnb/srslog/sink.h</label>
        <link refid="sink_8h_source"/>
        <childnode refid="41" relation="include">
        </childnode>
        <childnode refid="42" relation="include">
        </childnode>
        <childnode refid="43" relation="include">
        </childnode>
        <childnode refid="48" relation="include">
        </childnode>
      </node>
      <node id="91">
        <label>srsgnb/ran/pdcch/dci_packing.h</label>
        <link refid="dci__packing_8h_source"/>
        <childnode refid="7" relation="include">
        </childnode>
        <childnode refid="92" relation="include">
        </childnode>
        <childnode refid="67" relation="include">
        </childnode>
      </node>
      <node id="25">
        <label>srsgnb/support/math_utils.h</label>
        <link refid="math__utils_8h"/>
        <childnode refid="26" relation="include">
        </childnode>
        <childnode refid="28" relation="include">
        </childnode>
        <childnode refid="48" relation="include">
        </childnode>
        <childnode refid="11" relation="include">
        </childnode>
      </node>
      <node id="39">
        <label>pthread.h</label>
      </node>
      <node id="26">
        <label>srsgnb/adt/complex.h</label>
        <link refid="complex_8h_source"/>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="27" relation="include">
        </childnode>
      </node>
      <node id="18">
        <label>cstdio</label>
      </node>
      <node id="73">
        <label>srsgnb/adt/expected.h</label>
        <link refid="expected_8h_source"/>
        <childnode refid="28" relation="include">
        </childnode>
        <childnode refid="14" relation="include">
        </childnode>
        <childnode refid="74" relation="include">
        </childnode>
      </node>
      <node id="70">
        <label>bitset</label>
      </node>
      <node id="47">
        <label>tuple</label>
      </node>
      <node id="32">
        <label>srsgnb/srslog/log_channel.h</label>
        <link refid="log__channel_8h_source"/>
        <childnode refid="33" relation="include">
        </childnode>
        <childnode refid="35" relation="include">
        </childnode>
        <childnode refid="40" relation="include">
        </childnode>
        <childnode refid="49" relation="include">
        </childnode>
      </node>
      <node id="122">
        <label>srsgnb/ran/resource_allocation/resource_allocation_frequency.h</label>
        <link refid="resource__allocation__frequency_8h_source"/>
      </node>
      <node id="24">
        <label>vector</label>
      </node>
      <node id="106">
        <label>../ue_scheduling/ue_configuration.h</label>
        <link refid="ue__configuration_8h_source"/>
        <childnode refid="72" relation="include">
        </childnode>
        <childnode refid="92" relation="include">
        </childnode>
        <childnode refid="79" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
      </node>
      <node id="97">
        <label>scheduler_feedback_handler.h</label>
        <link refid="scheduler__feedback__handler_8h_source"/>
        <childnode refid="7" relation="include">
        </childnode>
        <childnode refid="92" relation="include">
        </childnode>
        <childnode refid="98" relation="include">
        </childnode>
        <childnode refid="79" relation="include">
        </childnode>
        <childnode refid="82" relation="include">
        </childnode>
      </node>
      <node id="110">
        <label>srsgnb/ran/prach/prach_configuration.h</label>
        <link refid="prach__configuration_8h_source"/>
        <childnode refid="92" relation="include">
        </childnode>
        <childnode refid="111" relation="include">
        </childnode>
        <childnode refid="60" relation="include">
        </childnode>
        <childnode refid="104" relation="include">
        </childnode>
        <childnode refid="84" relation="include">
        </childnode>
        <childnode refid="12" relation="include">
        </childnode>
      </node>
      <node id="53">
        <label>utility</label>
      </node>
      <node id="38">
        <label>srsgnb/srslog/detail/support/thread_utils.h</label>
        <link refid="thread__utils_8h_source"/>
        <childnode refid="39" relation="include">
        </childnode>
      </node>
      <node id="17">
        <label>array</label>
      </node>
      <node id="100">
        <label>sched_consts.h</label>
        <link refid="sched__consts_8h_source"/>
        <childnode refid="58" relation="include">
        </childnode>
        <childnode refid="46" relation="include">
        </childnode>
      </node>
      <node id="107">
        <label>../support/slot_event_list.h</label>
        <link refid="slot__event__list_8h_source"/>
        <childnode refid="63" relation="include">
        </childnode>
        <childnode refid="108" relation="include">
        </childnode>
        <childnode refid="24" relation="include">
        </childnode>
      </node>
      <node id="57">
        <label>srsgnb/adt/interval.h</label>
        <link refid="interval_8h_source"/>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="28" relation="include">
        </childnode>
        <childnode refid="48" relation="include">
        </childnode>
        <childnode refid="22" relation="include">
        </childnode>
        <childnode refid="23" relation="include">
        </childnode>
      </node>
      <node id="45">
        <label>srsgnb/srslog/detail/support/tmpl_utils.h</label>
        <link refid="tmpl__utils_8h_source"/>
        <childnode refid="46" relation="include">
        </childnode>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="47" relation="include">
        </childnode>
        <childnode refid="23" relation="include">
        </childnode>
      </node>
      <node id="55">
        <label>resource_block_group.h</label>
        <link refid="resource__block__group_8h_source"/>
        <childnode refid="7" relation="include">
        </childnode>
        <childnode refid="56" relation="include">
        </childnode>
      </node>
      <node id="92">
        <label>srsgnb/adt/static_vector.h</label>
        <link refid="static__vector_8h_source"/>
        <childnode refid="52" relation="include">
        </childnode>
        <childnode refid="28" relation="include">
        </childnode>
        <childnode refid="21" relation="include">
        </childnode>
        <childnode refid="14" relation="include">
        </childnode>
      </node>
      <node id="2">
        <label>ra_scheduler.h</label>
        <link refid="ra__scheduler_8h_source"/>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="105" relation="include">
        </childnode>
        <childnode refid="107" relation="include">
        </childnode>
        <childnode refid="109" relation="include">
        </childnode>
        <childnode refid="110" relation="include">
        </childnode>
        <childnode refid="112" relation="include">
        </childnode>
      </node>
      <node id="60">
        <label>srsgnb/ran/frequency_range.h</label>
        <link refid="frequency__range_8h_source"/>
      </node>
      <node id="10">
        <label>cerrno</label>
      </node>
      <node id="1">
        <label>lib/scheduler/common_scheduling/ra_scheduler.cpp</label>
        <link refid="ra__scheduler_8cpp"/>
        <childnode refid="2" relation="include">
        </childnode>
        <childnode refid="113" relation="include">
        </childnode>
        <childnode refid="115" relation="include">
        </childnode>
        <childnode refid="118" relation="include">
        </childnode>
        <childnode refid="116" relation="include">
        </childnode>
        <childnode refid="119" relation="include">
        </childnode>
        <childnode refid="122" relation="include">
        </childnode>
      </node>
      <node id="63">
        <label>span.h</label>
        <link refid="span_8h_source"/>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="9" relation="include">
        </childnode>
        <childnode refid="17" relation="include">
        </childnode>
        <childnode refid="48" relation="include">
        </childnode>
        <childnode refid="21" relation="include">
        </childnode>
        <childnode refid="23" relation="include">
        </childnode>
        <childnode refid="24" relation="include">
        </childnode>
      </node>
      <node id="90">
        <label>srsgnb/ran/pdcch/aggregation_level.h</label>
        <link refid="aggregation__level_8h_source"/>
        <childnode refid="12" relation="include">
        </childnode>
      </node>
      <node id="77">
        <label>band_helper.h</label>
        <link refid="band__helper_8h_source"/>
        <childnode refid="78" relation="include">
        </childnode>
      </node>
      <node id="46">
        <label>cstddef</label>
      </node>
      <node id="119">
        <label>../support/dmrs_helpers.h</label>
        <link refid="dmrs__helpers_8h_source"/>
        <childnode refid="72" relation="include">
        </childnode>
        <childnode refid="120" relation="include">
        </childnode>
        <childnode refid="99" relation="include">
        </childnode>
        <childnode refid="121" relation="include">
        </childnode>
      </node>
      <node id="5">
        <label>srsgnb/scheduler/bwp_configuration.h</label>
        <link refid="bwp__configuration_8h_source"/>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="54" relation="include">
        </childnode>
        <childnode refid="51" relation="include">
        </childnode>
        <childnode refid="62" relation="include">
        </childnode>
        <childnode refid="64" relation="include">
        </childnode>
        <childnode refid="65" relation="include">
        </childnode>
        <childnode refid="66" relation="include">
        </childnode>
        <childnode refid="69" relation="include">
        </childnode>
        <childnode refid="58" relation="include">
        </childnode>
        <childnode refid="70" relation="include">
        </childnode>
      </node>
      <node id="112">
        <label>deque</label>
      </node>
      <node id="113">
        <label>../../ran/gnb_format.h</label>
        <link refid="gnb__format_8h_source"/>
        <childnode refid="79" relation="include">
        </childnode>
        <childnode refid="96" relation="include">
        </childnode>
        <childnode refid="82" relation="include">
        </childnode>
        <childnode refid="29" relation="include">
        </childnode>
        <childnode refid="114" relation="include">
        </childnode>
      </node>
      <node id="116">
        <label>../support/config_helpers.h</label>
        <link refid="config__helpers_8h_source"/>
        <childnode refid="5" relation="include">
        </childnode>
      </node>
      <node id="108">
        <label>mutex</label>
      </node>
      <node id="87">
        <label>srsgnb/adt/bounded_integer.h</label>
        <link refid="bounded__integer_8h_source"/>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="28" relation="include">
        </childnode>
        <childnode refid="23" relation="include">
        </childnode>
      </node>
      <node id="37">
        <label>chrono</label>
      </node>
      <node id="33">
        <label>srsgnb/srslog/detail/log_backend.h</label>
        <link refid="log__backend_8h_source"/>
        <childnode refid="16" relation="include">
        </childnode>
        <childnode refid="34" relation="include">
        </childnode>
      </node>
      <node id="51">
        <label>srsgnb/adt/optional.h</label>
        <link refid="optional_8h_source"/>
        <childnode refid="52" relation="include">
        </childnode>
        <childnode refid="28" relation="include">
        </childnode>
      </node>
      <node id="36">
        <label>srsgnb/srslog/detail/log_entry_metadata.h</label>
        <link refid="log__entry__metadata_8h_source"/>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="37" relation="include">
        </childnode>
      </node>
      <node id="120">
        <label>pdsch/pdsch_dmrs_symbol_mask.h</label>
        <link refid="pdsch__dmrs__symbol__mask_8h_source"/>
        <childnode refid="6" relation="include">
        </childnode>
      </node>
      <node id="31">
        <label>srsgnb/srslog/logger.h</label>
        <link refid="logger_8h_source"/>
        <childnode refid="32" relation="include">
        </childnode>
      </node>
      <node id="61">
        <label>srsgnb/ran/sliv.h</label>
        <link refid="sliv_8h_source"/>
        <childnode refid="23" relation="include">
        </childnode>
      </node>
      <node id="29">
        <label>srsgnb/srslog/srslog.h</label>
        <link refid="srslog_8h_source"/>
        <childnode refid="30" relation="include">
        </childnode>
        <childnode refid="31" relation="include">
        </childnode>
        <childnode refid="34" relation="include">
        </childnode>
      </node>
      <node id="65">
        <label>srsgnb/ran/ofdm_symbol_range.h</label>
        <link refid="ofdm__symbol__range_8h_source"/>
        <childnode refid="57" relation="include">
        </childnode>
        <childnode refid="64" relation="include">
        </childnode>
        <childnode refid="61" relation="include">
        </childnode>
      </node>
      <node id="98">
        <label>srsgnb/mac/bsr_format.h</label>
        <link refid="bsr__format_8h_source"/>
      </node>
      <node id="67">
        <label>srsgnb/ran/pdcch/pdcch_constants.h</label>
        <link refid="pdcch__constants_8h_source"/>
        <childnode refid="68" relation="include">
        </childnode>
      </node>
      <node id="58">
        <label>srsgnb/ran/resource_block.h</label>
        <link refid="resource__block_8h_source"/>
        <childnode refid="59" relation="include">
        </childnode>
        <childnode refid="12" relation="include">
        </childnode>
      </node>
      <node id="23">
        <label>type_traits</label>
      </node>
      <node id="115">
        <label>../pdcch_scheduling/pdcch_config_helpers.h</label>
        <link refid="pdcch__config__helpers_8h_source"/>
        <childnode refid="116" relation="include">
        </childnode>
        <childnode refid="117" relation="include">
        </childnode>
        <childnode refid="84" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
      </node>
      <node id="81">
        <label>srsgnb/ran/phy_time_unit.h</label>
        <link refid="phy__time__unit_8h_source"/>
        <childnode refid="59" relation="include">
        </childnode>
        <childnode refid="25" relation="include">
        </childnode>
      </node>
      <node id="79">
        <label>srsgnb/ran/du_types.h</label>
        <link refid="du__types_8h_source"/>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="23" relation="include">
        </childnode>
      </node>
      <node id="27">
        <label>complex</label>
      </node>
      <node id="9">
        <label>algorithm</label>
      </node>
      <node id="30">
        <label>srsgnb/srslog/detail/support/any.h</label>
        <link refid="any_8h_source"/>
        <childnode refid="14" relation="include">
        </childnode>
        <childnode refid="23" relation="include">
        </childnode>
      </node>
      <node id="4">
        <label>../support/bwp_helpers.h</label>
        <link refid="bwp__helpers_8h_source"/>
        <childnode refid="5" relation="include">
        </childnode>
      </node>
      <node id="103">
        <label>srsgnb/ran/sch_mcs.h</label>
        <link refid="sch__mcs_8h_source"/>
        <childnode refid="87" relation="include">
        </childnode>
        <childnode refid="101" relation="include">
        </childnode>
      </node>
      <node id="114">
        <label>srsgnb/support/format_utils.h</label>
        <link refid="format__utils_8h_source"/>
        <childnode refid="8" relation="include">
        </childnode>
      </node>
      <node id="19">
        <label>cstring</label>
      </node>
      <node id="43">
        <label>srsgnb/srslog/formatter.h</label>
        <link refid="formatter_8h_source"/>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="44" relation="include">
        </childnode>
      </node>
      <node id="80">
        <label>srsgnb/ran/pci.h</label>
        <link refid="pci_8h_source"/>
        <childnode refid="12" relation="include">
        </childnode>
      </node>
      <node id="118">
        <label>../pdcch_scheduling/pdcch_scheduler_impl.h</label>
        <link refid="pdcch__scheduler__impl_8h_source"/>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="106" relation="include">
        </childnode>
        <childnode refid="105" relation="include">
        </childnode>
        <childnode refid="89" relation="include">
        </childnode>
      </node>
      <node id="16">
        <label>core.h</label>
        <link refid="core_8h_source"/>
        <childnode refid="17" relation="include">
        </childnode>
        <childnode refid="18" relation="include">
        </childnode>
        <childnode refid="19" relation="include">
        </childnode>
        <childnode refid="20" relation="include">
        </childnode>
        <childnode refid="21" relation="include">
        </childnode>
        <childnode refid="14" relation="include">
        </childnode>
        <childnode refid="22" relation="include">
        </childnode>
        <childnode refid="23" relation="include">
        </childnode>
        <childnode refid="24" relation="include">
        </childnode>
      </node>
      <node id="89">
        <label>srsgnb/scheduler/scheduler_dci.h</label>
        <link refid="scheduler__dci_8h_source"/>
        <childnode refid="54" relation="include">
        </childnode>
        <childnode refid="90" relation="include">
        </childnode>
        <childnode refid="91" relation="include">
        </childnode>
        <childnode refid="82" relation="include">
        </childnode>
        <childnode refid="84" relation="include">
        </childnode>
        <childnode refid="12" relation="include">
        </childnode>
      </node>
      <node id="14">
        <label>memory</label>
      </node>
      <node id="50">
        <label>inttypes.h</label>
      </node>
      <node id="62">
        <label>srsgnb/adt/slot_array.h</label>
        <link refid="slot__array_8h_source"/>
        <childnode refid="51" relation="include">
        </childnode>
        <childnode refid="63" relation="include">
        </childnode>
        <childnode refid="28" relation="include">
        </childnode>
        <childnode refid="17" relation="include">
        </childnode>
      </node>
    </incdepgraph>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="comment">/*</highlight></codeline>
<codeline lineno="2"><highlight class="comment"><sp/>*</highlight></codeline>
<codeline lineno="3"><highlight class="comment"><sp/>*<sp/>Copyright<sp/>2013-2022<sp/>Software<sp/>Radio<sp/>Systems<sp/>Limited</highlight></codeline>
<codeline lineno="4"><highlight class="comment"><sp/>*</highlight></codeline>
<codeline lineno="5"><highlight class="comment"><sp/>*<sp/>By<sp/>using<sp/>this<sp/>file,<sp/>you<sp/>agree<sp/>to<sp/>the<sp/>terms<sp/>and<sp/>conditions<sp/>set</highlight></codeline>
<codeline lineno="6"><highlight class="comment"><sp/>*<sp/>forth<sp/>in<sp/>the<sp/>LICENSE<sp/>file<sp/>which<sp/>can<sp/>be<sp/>found<sp/>at<sp/>the<sp/>top<sp/>level<sp/>of</highlight></codeline>
<codeline lineno="7"><highlight class="comment"><sp/>*<sp/>the<sp/>distribution.</highlight></codeline>
<codeline lineno="8"><highlight class="comment"><sp/>*</highlight></codeline>
<codeline lineno="9"><highlight class="comment"><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="10"><highlight class="normal"></highlight></codeline>
<codeline lineno="11"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;ra_scheduler.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="12"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;../../ran/gnb_format.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="13"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;../pdcch_scheduling/pdcch_config_helpers.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="14"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;../pdcch_scheduling/pdcch_scheduler_impl.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="15"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;../support/config_helpers.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="16"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;../support/dmrs_helpers.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="17"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;srsgnb/ran/resource_allocation/resource_allocation_frequency.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="18"><highlight class="normal"></highlight></codeline>
<codeline lineno="19"><highlight class="normal"></highlight><highlight class="keyword">using<sp/>namespace<sp/></highlight><highlight class="normal"><ref refid="namespacesrsgnb" kindref="compound">srsgnb</ref>;</highlight></codeline>
<codeline lineno="20"><highlight class="normal"></highlight></codeline>
<codeline lineno="21" refid="namespacesrsgnb_1a890506b2184eacc8a9091b7349eda0bf" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/><ref refid="namespacesrsgnb_1a890506b2184eacc8a9091b7349eda0bf" kindref="member">srsgnb::get_msg3_delay</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsrsgnb_1_1pusch__time__domain__resource__allocation" kindref="compound">pusch_time_domain_resource_allocation</ref>&amp;<sp/>pusch_td_res_alloc,</highlight></codeline>
<codeline lineno="22"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespacesrsgnb_1a249e926de5b299d3da9f403c93168d98" kindref="member">subcarrier_spacing</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pusch_scs)</highlight></codeline>
<codeline lineno="23"><highlight class="normal">{</highlight></codeline>
<codeline lineno="24"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>In<sp/>TS<sp/>38.214,<sp/>Table<sp/>6.1.2.1.1-5,<sp/>Delta<sp/>is<sp/>only<sp/>defined<sp/>for<sp/>PUSCH<sp/>SCS<sp/>within<sp/>[kHz15,<sp/>kHz120kHz].</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="25"><highlight class="normal"><sp/><sp/>srsgnb_sanity_check(<ref refid="namespacesrsgnb_1a1aaa9631bfc12855cc12d7ae3f6ce3a8" kindref="member">to_numerology_value</ref>(pusch_scs)<sp/>&lt;=<sp/><ref refid="namespacesrsgnb_1a1aaa9631bfc12855cc12d7ae3f6ce3a8" kindref="member">to_numerology_value</ref>(subcarrier_spacing::kHz120),</highlight></codeline>
<codeline lineno="26"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;PUSCH<sp/>subcarrier<sp/>spacing<sp/>not<sp/>supported<sp/>for<sp/>MSG3<sp/>delay&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="27"><highlight class="normal"></highlight></codeline>
<codeline lineno="28"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>The<sp/>array<sp/>represents<sp/>Table<sp/>6.1.2.1.1-5,<sp/>in<sp/>TS<sp/>38.214.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="29"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>std::array&lt;uint8_t,<sp/>4&gt;<sp/>DELTAS{2,<sp/>3,<sp/>4,<sp/>6};</highlight></codeline>
<codeline lineno="30"><highlight class="normal"></highlight></codeline>
<codeline lineno="31"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>The<sp/>MSG3<sp/>slot<sp/>is<sp/>defined<sp/>as<sp/>MSG3_slot<sp/>=<sp/>floor(<sp/>n<sp/>*<sp/>(2^*(mu_PUSCH)<sp/>)<sp/>/<sp/>(2^*(mu_PDCCH)<sp/>)<sp/>)<sp/>+<sp/>k2<sp/>+<sp/>Delta.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="32"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Given<sp/>the<sp/>assumption<sp/>mu_PUSCH<sp/>==<sp/>mu_PDCCH,<sp/>MSG3_delay<sp/>simplifies<sp/>to<sp/>MSG3_delay<sp/>=<sp/><sp/>k2<sp/>+<sp/>Delta</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="33"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>[TS<sp/>38.214,<sp/>Section<sp/>6.1.2.1<sp/>and<sp/>6.1.2.1.1].</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="34"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static_cast&lt;</highlight><highlight class="keywordtype">int</highlight><highlight class="keyword">&gt;</highlight><highlight class="normal">(pusch_td_res_alloc.<ref refid="structsrsgnb_1_1pusch__time__domain__resource__allocation_1a58a13c680c9e0e5eba14ce2b973d46be" kindref="member">k2</ref><sp/>+<sp/>DELTAS[<ref refid="namespacesrsgnb_1a1aaa9631bfc12855cc12d7ae3f6ce3a8" kindref="member">to_numerology_value</ref>(pusch_scs)]);</highlight></codeline>
<codeline lineno="35"><highlight class="normal">}</highlight></codeline>
<codeline lineno="36"><highlight class="normal"></highlight></codeline>
<codeline lineno="37" refid="namespacesrsgnb_1a42a3cddf5672000e229f3c0cdc34f467" refkind="member"><highlight class="normal">uint16_t<sp/><ref refid="namespacesrsgnb_1a42a3cddf5672000e229f3c0cdc34f467" kindref="member">srsgnb::get_ra_rnti</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsrsgnb_1_1rach__indication__message" kindref="compound">rach_indication_message</ref>&amp;<sp/>rach_ind,<sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>is_sul)</highlight></codeline>
<codeline lineno="38"><highlight class="normal">{</highlight></codeline>
<codeline lineno="39"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>See<sp/>38.321,<sp/>5.1.3<sp/>-<sp/>Random<sp/>Access<sp/>Preamble<sp/>transmission</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="40"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>RA-RNTI<sp/>=<sp/>1<sp/>+<sp/>s_id<sp/>+<sp/>14<sp/>×<sp/>t_id<sp/>+<sp/>14<sp/>×<sp/>80<sp/>×<sp/>f_id<sp/>+<sp/>14<sp/>×<sp/>80<sp/>×<sp/>8<sp/>×<sp/>ul_carrier_id</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="41"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>s_id<sp/>=<sp/>index<sp/>of<sp/>the<sp/>first<sp/>OFDM<sp/>symbol<sp/>(0<sp/>&lt;=<sp/>s_id<sp/>&lt;<sp/>14)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="42"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>t_id<sp/>=<sp/>index<sp/>of<sp/>first<sp/>slot<sp/>of<sp/>the<sp/>PRACH<sp/>(0<sp/>&lt;=<sp/>t_id<sp/>&lt;<sp/>80)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="43"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>f_id<sp/>=<sp/>index<sp/>of<sp/>the<sp/>PRACH<sp/>in<sp/>the<sp/>freq<sp/>domain<sp/>(0<sp/>&lt;=<sp/>f_id<sp/>&lt;<sp/>8)<sp/>(for<sp/>FDD,<sp/>f_id=0)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="44"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>ul_carrier_id<sp/>=<sp/>0<sp/>for<sp/>NUL<sp/>and<sp/>1<sp/>for<sp/>SUL<sp/>carrier</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="45"><highlight class="normal"><sp/><sp/>uint16_t<sp/>ra_rnti<sp/>=<sp/>1<sp/>+<sp/>rach_ind.<ref refid="structsrsgnb_1_1rach__indication__message_1ae2b79a8ddd289f0bb48a849f3e70cc2d" kindref="member">symbol_index</ref><sp/>+<sp/>14<sp/>*<sp/>rach_ind.slot_rx.<ref refid="classsrsgnb_1_1slot__point_1a3c10067548735ef432b9c9186f127b8e" kindref="member">slot_index</ref>()<sp/>+</highlight></codeline>
<codeline lineno="46"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>14<sp/>*<sp/>80<sp/>*<sp/>rach_ind.frequency_index<sp/>+<sp/>(14<sp/>*<sp/>80<sp/>*<sp/>8<sp/>*<sp/>(is_sul<sp/>?<sp/>1<sp/>:<sp/>0));</highlight></codeline>
<codeline lineno="47"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>ra_rnti;</highlight></codeline>
<codeline lineno="48"><highlight class="normal">}</highlight></codeline>
<codeline lineno="49"><highlight class="normal"></highlight></codeline>
<codeline lineno="51"><highlight class="normal"></highlight></codeline>
<codeline lineno="52"><highlight class="normal">ra_scheduler::ra_scheduler(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="classsrsgnb_1_1cell__configuration" kindref="compound">cell_configuration</ref>&amp;<sp/>cfg_,<sp/><ref refid="classsrsgnb_1_1pdcch__scheduler" kindref="compound">pdcch_scheduler</ref>&amp;<sp/>pdcch_sch_)<sp/>:</highlight></codeline>
<codeline lineno="53"><highlight class="normal"><sp/><sp/>cfg(cfg_),</highlight></codeline>
<codeline lineno="54"><highlight class="normal"><sp/><sp/>pdcch_sch(pdcch_sch_),</highlight></codeline>
<codeline lineno="55"><highlight class="normal"><sp/><sp/>ra_win_nof_slots(cfg.ul_cfg_common.init_ul_bwp.rach_cfg_common-&gt;rach_cfg_generic.ra_resp_window),</highlight></codeline>
<codeline lineno="56"><highlight class="normal"><sp/><sp/>initial_active_dl_bwp(cfg.dl_cfg_common.init_dl_bwp.generic_params),</highlight></codeline>
<codeline lineno="57"><highlight class="normal"><sp/><sp/>pending_msg3s(MAX_NOF_MSG3)</highlight></codeline>
<codeline lineno="58"><highlight class="normal">{</highlight></codeline>
<codeline lineno="59"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(cfg.dl_cfg_common.init_dl_bwp.pdcch_common.coreset0.has_value())<sp/>{</highlight></codeline>
<codeline lineno="60"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>See<sp/>38.213<sp/>-<sp/>If<sp/>a<sp/>UE<sp/>is<sp/>not<sp/>provided<sp/>initialDownlinkBWP,<sp/>an<sp/>initial<sp/>active<sp/>DL<sp/>BWP<sp/>is<sp/>defined<sp/>by<sp/>a<sp/>location</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="61"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>and<sp/>number<sp/>of<sp/>contiguous<sp/>PRBs,<sp/>starting<sp/>from<sp/>a<sp/>PRB<sp/>with<sp/>the<sp/>lowest<sp/>index<sp/>and<sp/>ending<sp/>at<sp/>a<sp/>PRB<sp/>with<sp/>the<sp/>highest</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="62"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>index<sp/>among<sp/>PRBs<sp/>of<sp/>a<sp/>CORESET<sp/>for<sp/>Type0-PDCCH<sp/>CSS<sp/>set,<sp/>and<sp/>a<sp/>SCS<sp/>and<sp/>a<sp/>cyclic<sp/>prefix<sp/>for<sp/>PDCCH<sp/>reception<sp/>in<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="63"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>CORESET<sp/>for<sp/>Type0-PDCCH<sp/>CSS<sp/>set.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="64"><highlight class="normal"><sp/><sp/><sp/><sp/>initial_active_dl_bwp.crbs<sp/>=<sp/><ref refid="namespacesrsgnb_1a843bb84acff200e7fd6684725c76a3d7" kindref="member">get_coreset0_crbs</ref>(cfg.dl_cfg_common.init_dl_bwp.pdcch_common);</highlight></codeline>
<codeline lineno="65"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="66"><highlight class="normal">}</highlight></codeline>
<codeline lineno="67"><highlight class="normal"></highlight></codeline>
<codeline lineno="68" refid="classsrsgnb_1_1ra__scheduler_1a458acf6cb413052be3cfa62d81d67387" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>ra_scheduler::handle_rach_indication(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsrsgnb_1_1rach__indication__message" kindref="compound">rach_indication_message</ref>&amp;<sp/>msg)</highlight></codeline>
<codeline lineno="69"><highlight class="normal">{</highlight></codeline>
<codeline lineno="70"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Buffer<sp/>detected<sp/>RACHs<sp/>to<sp/>be<sp/>handled<sp/>in<sp/>next<sp/>slot.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="71"><highlight class="normal"><sp/><sp/>pending_rachs.push(msg);</highlight></codeline>
<codeline lineno="72"><highlight class="normal">}</highlight></codeline>
<codeline lineno="73"><highlight class="normal"></highlight></codeline>
<codeline lineno="74"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>ra_scheduler::handle_rach_indication_impl(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsrsgnb_1_1rach__indication__message" kindref="compound">rach_indication_message</ref>&amp;<sp/>msg)</highlight></codeline>
<codeline lineno="75"><highlight class="normal">{</highlight></codeline>
<codeline lineno="76"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/>prach_duration<sp/>=<sp/>1;<sp/></highlight><highlight class="comment">//<sp/>TODO:<sp/>Take<sp/>from<sp/>config</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="77"><highlight class="normal"></highlight></codeline>
<codeline lineno="78"><highlight class="normal"><sp/><sp/>uint16_t<sp/>ra_rnti<sp/>=<sp/><ref refid="namespacesrsgnb_1a42a3cddf5672000e229f3c0cdc34f467" kindref="member">get_ra_rnti</ref>(msg);</highlight></codeline>
<codeline lineno="79"><highlight class="normal"></highlight></codeline>
<codeline lineno="80"><highlight class="normal"><sp/><sp/>logger.info(</highlight><highlight class="stringliteral">&quot;SCHED:<sp/>New<sp/>PRACH<sp/>slot={},<sp/>preamble={},<sp/>ra-rnti=0x{:x},<sp/>temp_crnti=0x{:x},<sp/>ta_cmd={}&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="81"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>msg.slot_rx,</highlight></codeline>
<codeline lineno="82"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>msg.preamble_id,</highlight></codeline>
<codeline lineno="83"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ra_rnti,</highlight></codeline>
<codeline lineno="84"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>msg.crnti,</highlight></codeline>
<codeline lineno="85"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>msg.timing_advance.<ref refid="classsrsgnb_1_1phy__time__unit_1a61391ed7d44d3aae421439e8aad97e39" kindref="member">to_Ta</ref>(get_ul_bwp_cfg().scs));</highlight></codeline>
<codeline lineno="86"><highlight class="normal"></highlight></codeline>
<codeline lineno="87"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Check<sp/>if<sp/>TC-RNTI<sp/>value<sp/>to<sp/>be<sp/>scheduled<sp/>is<sp/>already<sp/>under<sp/>use</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="88"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(not<sp/>pending_msg3s[msg.crnti<sp/>%<sp/><ref refid="classsrsgnb_1_1ra__scheduler_1adbf15d9756db8db431a332414711b3b4" kindref="member">MAX_NOF_MSG3</ref>].harq.empty())<sp/>{</highlight></codeline>
<codeline lineno="89"><highlight class="normal"><sp/><sp/><sp/><sp/>logger.warning(</highlight><highlight class="stringliteral">&quot;PRACH<sp/>ignored,<sp/>as<sp/>the<sp/>allocated<sp/>TC-RNTI=0x{:x}<sp/>is<sp/>already<sp/>under<sp/>use&quot;</highlight><highlight class="normal">,<sp/>msg.crnti);</highlight></codeline>
<codeline lineno="90"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="91"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="92"><highlight class="normal"></highlight></codeline>
<codeline lineno="93"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Find<sp/>pending<sp/>RAR<sp/>with<sp/>same<sp/>RA-RNTI</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="94"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>rar_found<sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="95"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(pending_rar_t&amp;<sp/>r<sp/>:<sp/>pending_rars)<sp/>{</highlight></codeline>
<codeline lineno="96"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(r.prach_slot_rx<sp/>==<sp/>msg.slot_rx<sp/>and<sp/>ra_rnti<sp/>==<sp/>r.ra_rnti)<sp/>{</highlight></codeline>
<codeline lineno="97"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(r.tc_rntis.full())<sp/>{</highlight></codeline>
<codeline lineno="98"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>logger.warning(</highlight><highlight class="stringliteral">&quot;PRACH<sp/>ignored,<sp/>as<sp/>the<sp/>the<sp/>maximum<sp/>number<sp/>of<sp/>RAR<sp/>grants<sp/>per<sp/>slot<sp/>has<sp/>been<sp/>reached.&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="99"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="100"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="101"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>r.tc_rntis.push_back(msg.crnti);</highlight></codeline>
<codeline lineno="102"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>rar_found<sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="103"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="104"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="105"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="106"><highlight class="normal"></highlight></codeline>
<codeline lineno="107"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(not<sp/>rar_found)<sp/>{</highlight></codeline>
<codeline lineno="108"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Create<sp/>new<sp/>pending<sp/>RAR</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="109"><highlight class="normal"><sp/><sp/><sp/><sp/>pending_rars.emplace_back();</highlight></codeline>
<codeline lineno="110"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal">&amp;<sp/>rar_req<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>pending_rars.back();</highlight></codeline>
<codeline lineno="111"><highlight class="normal"><sp/><sp/><sp/><sp/>rar_req.ra_rnti<sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/><ref refid="namespacesrsgnb_1a061fb0d6bbe0a7462c555854c5dace03" kindref="member">to_rnti</ref>(ra_rnti);</highlight></codeline>
<codeline lineno="112"><highlight class="normal"><sp/><sp/><sp/><sp/>rar_req.prach_slot_rx<sp/>=<sp/>msg.slot_rx;</highlight></codeline>
<codeline lineno="113"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>First<sp/>slot<sp/>after<sp/>PRACH<sp/>with<sp/>active<sp/>DL<sp/>slot<sp/>represents<sp/>the<sp/>start<sp/>of<sp/>the<sp/>RAR<sp/>window.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="114"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(cfg.tdd_cfg_common.has_value())<sp/>{</highlight></codeline>
<codeline lineno="115"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>TDD<sp/>case.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="116"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/>period<sp/>=<sp/><ref refid="namespacesrsgnb_1ac37046979c3e23c29f66f49b7bb02aa3" kindref="member">nof_slots_per_tdd_period</ref>(*cfg.tdd_cfg_common);</highlight></codeline>
<codeline lineno="117"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/>sl_idx<sp/>=<sp/>0;<sp/>sl_idx<sp/>&lt;<sp/>period;<sp/>++sl_idx)<sp/>{</highlight></codeline>
<codeline lineno="118"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classsrsgnb_1_1slot__point" kindref="compound">slot_point</ref><sp/>sl_start<sp/>=<sp/>rar_req.prach_slot_rx<sp/>+<sp/>prach_duration<sp/>+<sp/>sl_idx;</highlight></codeline>
<codeline lineno="119"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(cfg.<ref refid="classsrsgnb_1_1cell__configuration_1ae70e713efb04880a3c22b81ff8a23208" kindref="member">is_dl_enabled</ref>(sl_start))<sp/>{</highlight></codeline>
<codeline lineno="120"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rar_req.rar_window<sp/>=<sp/>{sl_start,<sp/>sl_start<sp/>+<sp/>ra_win_nof_slots};</highlight></codeline>
<codeline lineno="121"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="122"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="123"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="124"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>srsgnb_sanity_check(rar_req.rar_window.length()<sp/>!=<sp/>0,<sp/></highlight><highlight class="stringliteral">&quot;Invalid<sp/>configuration&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="125"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="126"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>FDD<sp/>case.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="127"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>rar_req.rar_window<sp/>=<sp/>{rar_req.prach_slot_rx<sp/>+<sp/>prach_duration,</highlight></codeline>
<codeline lineno="128"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rar_req.prach_slot_rx<sp/>+<sp/>prach_duration<sp/>+<sp/>ra_win_nof_slots};</highlight></codeline>
<codeline lineno="129"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="130"><highlight class="normal"><sp/><sp/><sp/><sp/>rar_req.tc_rntis.push_back(msg.crnti);</highlight></codeline>
<codeline lineno="131"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="132"><highlight class="normal"></highlight></codeline>
<codeline lineno="133"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Store<sp/>Msg3<sp/>to<sp/>allocate</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="134"><highlight class="normal"><sp/><sp/>pending_msg3s[msg.crnti<sp/>%<sp/><ref refid="classsrsgnb_1_1ra__scheduler_1adbf15d9756db8db431a332414711b3b4" kindref="member">MAX_NOF_MSG3</ref>].ind_msg<sp/>=<sp/>msg;</highlight></codeline>
<codeline lineno="135"><highlight class="normal"></highlight></codeline>
<codeline lineno="136"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="137"><highlight class="normal">}</highlight></codeline>
<codeline lineno="138"><highlight class="normal"></highlight></codeline>
<codeline lineno="139" refid="classsrsgnb_1_1ra__scheduler_1a218ba7f4d2fe7d8d8f3f6b6e8eb82066" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classsrsgnb_1_1ra__scheduler_1a218ba7f4d2fe7d8d8f3f6b6e8eb82066" kindref="member">ra_scheduler::run_slot</ref>(<ref refid="structsrsgnb_1_1cell__resource__allocator" kindref="compound">cell_resource_allocator</ref>&amp;<sp/>res_alloc)</highlight></codeline>
<codeline lineno="140"><highlight class="normal">{</highlight></codeline>
<codeline lineno="141"><highlight class="normal"><sp/><sp/><ref refid="classsrsgnb_1_1slot__point" kindref="compound">slot_point</ref><sp/>pdcch_slot<sp/>=<sp/>res_alloc.<ref refid="structsrsgnb_1_1cell__resource__allocator_1a349d7be901f4a276bd9f45b0811be3a4" kindref="member">slot_tx</ref>();</highlight></codeline>
<codeline lineno="142"><highlight class="normal"></highlight></codeline>
<codeline lineno="143"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Pop<sp/>pending<sp/>RACHs<sp/>and<sp/>process<sp/>them.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="144"><highlight class="normal"><sp/><sp/>pending_rachs.slot_indication();</highlight></codeline>
<codeline lineno="145"><highlight class="normal"><sp/><sp/><ref refid="classsrsgnb_1_1span" kindref="compound">span&lt;const rach_indication_message&gt;</ref><sp/>new_rachs<sp/>=<sp/>pending_rachs.get_events();</highlight></codeline>
<codeline lineno="146"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsrsgnb_1_1rach__indication__message" kindref="compound">rach_indication_message</ref>&amp;<sp/>rach<sp/>:<sp/>new_rachs)<sp/>{</highlight></codeline>
<codeline lineno="147"><highlight class="normal"><sp/><sp/><sp/><sp/>handle_rach_indication_impl(rach);</highlight></codeline>
<codeline lineno="148"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="149"><highlight class="normal"></highlight></codeline>
<codeline lineno="150"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Ensure<sp/>slot<sp/>for<sp/>RAR<sp/>PDCCH+PDSCH<sp/>has<sp/>DL<sp/>enabled.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="151"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(not<sp/>cfg.<ref refid="classsrsgnb_1_1cell__configuration_1ae70e713efb04880a3c22b81ff8a23208" kindref="member">is_dl_enabled</ref>(pdcch_slot))<sp/>{</highlight></codeline>
<codeline lineno="152"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Early<sp/>exit.<sp/>RAR<sp/>scheduling<sp/>only<sp/>possible<sp/>when<sp/>PDCCH<sp/>and<sp/>PDSCH<sp/>are<sp/>available.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="153"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="154"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="155"><highlight class="normal"></highlight></codeline>
<codeline lineno="156"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Ensure<sp/>RA<sp/>SearchSpace<sp/>PDCCH<sp/>monitoring<sp/>is<sp/>active<sp/>for<sp/>this<sp/>slot.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="157"><highlight class="normal"><sp/><sp/><ref refid="namespacesrsgnb_1a66a5b6e7f9a3179978042eb82e981c65" kindref="member">search_space_id</ref><sp/>ss_id<sp/>=<sp/>cfg.dl_cfg_common.init_dl_bwp.pdcch_common.<ref refid="structsrsgnb_1_1pdcch__config__common_1ade67a3376dc53058290c2f3af227b5e3" kindref="member">ra_search_space_id</ref>;</highlight></codeline>
<codeline lineno="158"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(not<sp/><ref refid="namespacesrsgnb_1a5bcb84db93ea7deff3c22938b2567a25" kindref="member">is_pdcch_monitoring_active</ref>(pdcch_slot,<sp/>cfg.dl_cfg_common.init_dl_bwp.pdcch_common.<ref refid="structsrsgnb_1_1pdcch__config__common_1a39db8799331983e1abf5abab0a37425c" kindref="member">search_spaces</ref>[ss_id]))<sp/>{</highlight></codeline>
<codeline lineno="159"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Early<sp/>exit.<sp/>RAR<sp/>scheduling<sp/>only<sp/>possible<sp/>when<sp/>PDCCH<sp/>monitoring<sp/>is<sp/>active.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="160"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="161"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="162"><highlight class="normal"></highlight></codeline>
<codeline lineno="163"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Ensure<sp/>there<sp/>are<sp/>UL<sp/>slots<sp/>where<sp/>Msg3s<sp/>can<sp/>be<sp/>allocated.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="164"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>pusch_slots_available<sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="165"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal">&amp;<sp/>pusch_td_alloc<sp/>:</highlight></codeline>
<codeline lineno="166"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespacesrsgnb_1ad4f660af5791f7af81a8de014e465019" kindref="member">get_pusch_time_domain_resource_table</ref>(*cfg.ul_cfg_common.init_ul_bwp.pusch_cfg_common))<sp/>{</highlight></codeline>
<codeline lineno="167"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/>msg3_delay<sp/>=<sp/><ref refid="namespacesrsgnb_1a890506b2184eacc8a9091b7349eda0bf" kindref="member">get_msg3_delay</ref>(pusch_td_alloc,<sp/>get_ul_bwp_cfg().scs);</highlight></codeline>
<codeline lineno="168"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(cfg.is_ul_enabled(pdcch_slot<sp/>+<sp/>msg3_delay))<sp/>{</highlight></codeline>
<codeline lineno="169"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>pusch_slots_available<sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="170"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="171"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="172"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(not<sp/>pusch_slots_available)<sp/>{</highlight></codeline>
<codeline lineno="173"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Early<sp/>exit.<sp/>Msg3<sp/>scheduling<sp/>only<sp/>possible<sp/>when<sp/>PUSCH<sp/>is<sp/>available.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="174"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="175"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="176"><highlight class="normal"></highlight></codeline>
<codeline lineno="177"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/>it<sp/>=<sp/>pending_rars.begin();<sp/>it<sp/>!=<sp/>pending_rars.end();)<sp/>{</highlight></codeline>
<codeline lineno="178"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structsrsgnb_1_1ra__scheduler_1_1pending__rar__t" kindref="compound">pending_rar_t</ref>&amp;<sp/>rar_req<sp/>=<sp/>*it;</highlight></codeline>
<codeline lineno="179"><highlight class="normal"></highlight></codeline>
<codeline lineno="180"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>In<sp/>case<sp/>of<sp/>RAR<sp/>being<sp/>outside<sp/>RAR<sp/>window:</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="181"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>-<sp/>if<sp/>window<sp/>has<sp/>passed,<sp/>discard<sp/>RAR</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="182"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>-<sp/>if<sp/>window<sp/>hasn&apos;t<sp/>started,<sp/>stop<sp/>loop,<sp/>as<sp/>RARs<sp/>are<sp/>ordered<sp/>by<sp/>slot</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="183"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(not<sp/>rar_req.rar_window.<ref refid="classsrsgnb_1_1interval_1ac280e002d3db0cc5815bf63dbc770955" kindref="member">contains</ref>(pdcch_slot))<sp/>{</highlight></codeline>
<codeline lineno="184"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(pdcch_slot<sp/>&gt;=<sp/>rar_req.rar_window.stop())<sp/>{</highlight></codeline>
<codeline lineno="185"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fmt::memory_buffer<sp/>str_buffer;</highlight></codeline>
<codeline lineno="186"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fmt::format_to(str_buffer,</highlight></codeline>
<codeline lineno="187"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;SCHED:<sp/>Could<sp/>not<sp/>transmit<sp/>RAR<sp/>within<sp/>the<sp/>window={},<sp/>prach_slot={},<sp/>slot_tx={}&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="188"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rar_req.rar_window,</highlight></codeline>
<codeline lineno="189"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rar_req.prach_slot_rx,</highlight></codeline>
<codeline lineno="190"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pdcch_slot);</highlight></codeline>
<codeline lineno="191"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fmt::print(</highlight><highlight class="stringliteral">&quot;{}\n&quot;</highlight><highlight class="normal">,<sp/>to_c_str(str_buffer));</highlight></codeline>
<codeline lineno="192"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>logger.warning(</highlight><highlight class="stringliteral">&quot;{}&quot;</highlight><highlight class="normal">,<sp/>to_c_str(str_buffer));</highlight></codeline>
<codeline lineno="193"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>it<sp/>=<sp/>pending_rars.erase(it);</highlight></codeline>
<codeline lineno="194"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="195"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="196"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="197"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="198"><highlight class="normal"></highlight></codeline>
<codeline lineno="199"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Try<sp/>to<sp/>schedule<sp/>DCIs<sp/>+<sp/>RBGs<sp/>for<sp/>RAR<sp/>Grants</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="200"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>nof_allocs<sp/>=<sp/><ref refid="classsrsgnb_1_1ra__scheduler_1aa3f2f6f48a91de48e48819b317045439" kindref="member">schedule_rar</ref>(rar_req,<sp/>res_alloc);</highlight></codeline>
<codeline lineno="201"><highlight class="normal"><sp/><sp/><sp/><sp/>srsgnb_sanity_check(nof_allocs<sp/>&lt;=<sp/>rar_req.tc_rntis.size(),<sp/></highlight><highlight class="stringliteral">&quot;Invalid<sp/>number<sp/>of<sp/>RAR<sp/>allocs&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="202"><highlight class="normal"></highlight></codeline>
<codeline lineno="203"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(nof_allocs<sp/>&gt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="204"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>RAR<sp/>allocation<sp/>was<sp/>successful:</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="205"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>-<sp/>in<sp/>case<sp/>all<sp/>Msg3<sp/>grants<sp/>were<sp/>allocated,<sp/>remove<sp/>pending<sp/>RAR,<sp/>and<sp/>continue<sp/>with<sp/>following<sp/>RAR</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="206"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>-<sp/>otherwise,<sp/>erase<sp/>only<sp/>Msg3<sp/>grants<sp/>that<sp/>were<sp/>allocated,<sp/>and<sp/>stop<sp/>iteration</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="207"><highlight class="normal"></highlight></codeline>
<codeline lineno="208"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(nof_allocs<sp/>==<sp/>rar_req.tc_rntis.size())<sp/>{</highlight></codeline>
<codeline lineno="209"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>it<sp/>=<sp/>pending_rars.erase(it);</highlight></codeline>
<codeline lineno="210"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="211"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Remove<sp/>only<sp/>allocated<sp/>Msg3<sp/>grants</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="212"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>std::copy(rar_req.tc_rntis.begin()<sp/>+<sp/>nof_allocs,<sp/>rar_req.tc_rntis.end(),<sp/>rar_req.tc_rntis.begin());</highlight></codeline>
<codeline lineno="213"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>new_pending_msg3s<sp/>=<sp/>rar_req.tc_rntis.size()<sp/>&gt;<sp/>nof_allocs<sp/>?<sp/>rar_req.tc_rntis.size()<sp/>-<sp/>nof_allocs<sp/>:<sp/>0;</highlight></codeline>
<codeline lineno="214"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rar_req.tc_rntis.resize(new_pending_msg3s);</highlight></codeline>
<codeline lineno="215"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="216"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="217"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="218"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>RAR<sp/>allocation<sp/>was<sp/>not<sp/>successful,<sp/>try<sp/>next<sp/>pending<sp/>RAR</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="219"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>++it;</highlight></codeline>
<codeline lineno="220"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="221"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="222"><highlight class="normal"></highlight></codeline>
<codeline lineno="223"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Log<sp/>allocated<sp/>RARs.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="224"><highlight class="normal"><sp/><sp/>log_rars(res_alloc);</highlight></codeline>
<codeline lineno="225"><highlight class="normal">}</highlight></codeline>
<codeline lineno="226"><highlight class="normal"></highlight></codeline>
<codeline lineno="227" refid="classsrsgnb_1_1ra__scheduler_1aa3f2f6f48a91de48e48819b317045439" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/><ref refid="classsrsgnb_1_1ra__scheduler_1aa3f2f6f48a91de48e48819b317045439" kindref="member">ra_scheduler::schedule_rar</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsrsgnb_1_1ra__scheduler_1_1pending__rar__t" kindref="compound">pending_rar_t</ref>&amp;<sp/>rar,<sp/><ref refid="structsrsgnb_1_1cell__resource__allocator" kindref="compound">cell_resource_allocator</ref>&amp;<sp/>res_alloc)</highlight></codeline>
<codeline lineno="228"><highlight class="normal">{</highlight></codeline>
<codeline lineno="229"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>RAR<sp/>payload<sp/>size<sp/>in<sp/>bytes<sp/>as<sp/>per<sp/>TS38.321,<sp/>6.1.5<sp/>and<sp/>6.2.3.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="230"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/>static<sp/>const<sp/>unsigned<sp/>rar_payload_size_bytes<sp/>=<sp/>7,<sp/>rar_subheader_size_bytes<sp/>=<sp/>1;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="231"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>TODO:<sp/>Make<sp/>smarter<sp/>algorithm<sp/>for<sp/>RAR<sp/>size<sp/>derivation.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="232"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/>nof_prbs_per_rar<sp/>=<sp/>4,<sp/>nof_prbs_per_msg3<sp/>=<sp/>3;</highlight></codeline>
<codeline lineno="233"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/>pdsch_time_res_index<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="234"><highlight class="normal"></highlight></codeline>
<codeline lineno="235"><highlight class="normal"><sp/><sp/><ref refid="structsrsgnb_1_1cell__slot__resource__allocator" kindref="compound">cell_slot_resource_allocator</ref>&amp;<sp/>rar_alloc<sp/>=<sp/>res_alloc[0];</highlight></codeline>
<codeline lineno="236"><highlight class="normal"></highlight></codeline>
<codeline lineno="237"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>1.<sp/>Check<sp/>space<sp/>in<sp/>DL<sp/>sched<sp/>result<sp/>for<sp/>RAR.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="238"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(rar_alloc.<ref refid="structsrsgnb_1_1cell__slot__resource__allocator_1a8724d6f3f22a6c17ae31694f3b528153" kindref="member">result</ref>.dl.<ref refid="structsrsgnb_1_1dl__sched__result_1a4fbc52d52b7913aeb1c98bde41727557" kindref="member">rar_grants</ref>.full()<sp/>or<sp/>rar_alloc.<ref refid="structsrsgnb_1_1cell__slot__resource__allocator_1a8724d6f3f22a6c17ae31694f3b528153" kindref="member">result</ref>.dl.<ref refid="structsrsgnb_1_1dl__sched__result_1a3b8afa3e317da218903a0ce0013aecf9" kindref="member">dl_pdcchs</ref>.full())<sp/>{</highlight></codeline>
<codeline lineno="239"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>early<sp/>exit.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="240"><highlight class="normal"><sp/><sp/><sp/><sp/>log_postponed_rar(rar,<sp/></highlight><highlight class="stringliteral">&quot;No<sp/>PDCCH/PDSCH<sp/>space<sp/>for<sp/>RAR.&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="241"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="242"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="243"><highlight class="normal"></highlight></codeline>
<codeline lineno="244"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Start<sp/>with<sp/>the<sp/>higher<sp/>number<sp/>of<sp/>Msg3<sp/>grants<sp/>to<sp/>allocate,<sp/>and<sp/>keep<sp/>decrementing<sp/>based<sp/>on<sp/>available<sp/>space.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="245"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/>max_nof_allocs<sp/>=<sp/>rar.tc_rntis.size();</highlight></codeline>
<codeline lineno="246"><highlight class="normal"></highlight></codeline>
<codeline lineno="247"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>2.<sp/>Find<sp/>available<sp/>RBs<sp/>in<sp/>PDSCH<sp/>for<sp/>RAR<sp/>grant.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="248"><highlight class="normal"><sp/><sp/><ref refid="structsrsgnb_1_1crb__interval" kindref="compound">crb_interval</ref><sp/>rar_crbs;</highlight></codeline>
<codeline lineno="249"><highlight class="normal"><sp/><sp/>{</highlight></codeline>
<codeline lineno="250"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>nof_rar_rbs<sp/>=<sp/>nof_prbs_per_rar<sp/>*<sp/>max_nof_allocs;</highlight></codeline>
<codeline lineno="251"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structsrsgnb_1_1ofdm__symbol__range" kindref="compound">ofdm_symbol_range</ref><sp/>symbols<sp/>=</highlight></codeline>
<codeline lineno="252"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>cfg.dl_cfg_common.init_dl_bwp.pdsch_common.<ref refid="structsrsgnb_1_1pdsch__config__common_1a9ae93edd088068b36ce29029781ed84b" kindref="member">pdsch_td_alloc_list</ref>[pdsch_time_res_index].symbols;</highlight></codeline>
<codeline lineno="253"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classsrsgnb_1_1bounded__bitset" kindref="compound">crb_bitmap</ref><sp/>used_crbs<sp/>=<sp/>rar_alloc.<ref refid="structsrsgnb_1_1cell__slot__resource__allocator_1af1df59d8b7ca78390815806e0a552d8e" kindref="member">dl_res_grid</ref>.<ref refid="classsrsgnb_1_1cell__slot__resource__grid_1a987bac26435410ebf28670b492e71123" kindref="member">used_crbs</ref>(initial_active_dl_bwp,<sp/>symbols);</highlight></codeline>
<codeline lineno="254"><highlight class="normal"><sp/><sp/><sp/><sp/>rar_crbs<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/><ref refid="namespacesrsgnb_1a7c24c2d559727ab4fb6e0e4db881f0b4" kindref="member">find_empty_interval_of_length</ref>(used_crbs,<sp/>nof_rar_rbs,<sp/>0);</highlight></codeline>
<codeline lineno="255"><highlight class="normal"><sp/><sp/><sp/><sp/>max_nof_allocs<sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>rar_crbs.<ref refid="classsrsgnb_1_1interval_1afaa426e56c4e96208758552d97a7b43c" kindref="member">length</ref>()<sp/>/<sp/>nof_prbs_per_rar;</highlight></codeline>
<codeline lineno="256"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(max_nof_allocs<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="257"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>early<sp/>exit</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="258"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>log_postponed_rar(rar,<sp/></highlight><highlight class="stringliteral">&quot;Not<sp/>enough<sp/>PRBs<sp/>for<sp/>RAR.&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="259"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="260"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="261"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="262"><highlight class="normal"></highlight></codeline>
<codeline lineno="263"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>3.<sp/>Find<sp/>available<sp/>RBs<sp/>in<sp/>PUSCH<sp/>for<sp/>Msg3<sp/>grants.<sp/>This<sp/>process<sp/>requires<sp/>searching<sp/>for<sp/>a<sp/>valid<sp/>K2<sp/>value<sp/>in</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="264"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>the<sp/>list<sp/>of<sp/>PUSCH-TimeDomainResourceAllocation<sp/>in<sp/>PUSCHConfigCommon.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="265"><highlight class="normal"><sp/><sp/><ref refid="classsrsgnb_1_1static__vector" kindref="compound">static_vector&lt;msg3_alloc_candidate, MAX_GRANTS&gt;</ref><sp/>msg3_candidates;</highlight></codeline>
<codeline lineno="266"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pusch_list<sp/>=<sp/><ref refid="namespacesrsgnb_1ad4f660af5791f7af81a8de014e465019" kindref="member">get_pusch_time_domain_resource_table</ref>(get_pusch_cfg());</highlight></codeline>
<codeline lineno="267"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/>puschidx<sp/>=<sp/>0;<sp/>puschidx<sp/>&lt;<sp/>pusch_list.size();<sp/>++puschidx)<sp/>{</highlight></codeline>
<codeline lineno="268"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/>pusch_res_max_allocs<sp/>=<sp/>max_nof_allocs<sp/>-<sp/>msg3_candidates.size();</highlight></codeline>
<codeline lineno="269"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>3.<sp/>Verify<sp/>if<sp/>Msg3<sp/>delay<sp/>provided<sp/>by<sp/>current<sp/>PUSCH-TimeDomainResourceAllocation<sp/>corresponds<sp/>to<sp/>an<sp/>UL<sp/>slot.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="270"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>msg3_delay<sp/>=<sp/><ref refid="namespacesrsgnb_1a890506b2184eacc8a9091b7349eda0bf" kindref="member">get_msg3_delay</ref>(pusch_list[puschidx],<sp/>get_ul_bwp_cfg().scs);</highlight></codeline>
<codeline lineno="271"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structsrsgnb_1_1cell__slot__resource__allocator" kindref="compound">cell_slot_resource_allocator</ref>&amp;<sp/>msg3_alloc<sp/>=<sp/>res_alloc[msg3_delay];</highlight></codeline>
<codeline lineno="272"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(not<sp/>cfg.is_ul_enabled(msg3_alloc.<ref refid="structsrsgnb_1_1cell__slot__resource__allocator_1a05be11a3c949d1b681c5221c7254c79d" kindref="member">slot</ref>))<sp/>{</highlight></codeline>
<codeline lineno="273"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="274"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="275"><highlight class="normal"></highlight></codeline>
<codeline lineno="276"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>4.<sp/>Check<sp/>space<sp/>in<sp/>UL<sp/>sched<sp/>result<sp/>for<sp/>remaining<sp/>Msg3s.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="277"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/>list_space<sp/><sp/>=<sp/>msg3_alloc.<ref refid="structsrsgnb_1_1cell__slot__resource__allocator_1a8724d6f3f22a6c17ae31694f3b528153" kindref="member">result</ref>.ul.<ref refid="structsrsgnb_1_1ul__sched__result_1ac88b1e019615e31f6add6d928d7bf464" kindref="member">puschs</ref>.capacity()<sp/>-<sp/>msg3_alloc.<ref refid="structsrsgnb_1_1cell__slot__resource__allocator_1a8724d6f3f22a6c17ae31694f3b528153" kindref="member">result</ref>.ul.<ref refid="structsrsgnb_1_1ul__sched__result_1ac88b1e019615e31f6add6d928d7bf464" kindref="member">puschs</ref>.size();</highlight></codeline>
<codeline lineno="278"><highlight class="normal"><sp/><sp/><sp/><sp/>pusch_res_max_allocs<sp/>=<sp/>std::min(pusch_res_max_allocs,<sp/>list_space);</highlight></codeline>
<codeline lineno="279"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(pusch_res_max_allocs<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="280"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="281"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="282"><highlight class="normal"></highlight></codeline>
<codeline lineno="283"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>5.<sp/>Check<sp/>CRBs<sp/>available<sp/>in<sp/>PUSCH<sp/>for<sp/>Msg3.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="284"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/>nof_msg3_prbs<sp/>=<sp/>nof_prbs_per_msg3<sp/>*<sp/>pusch_res_max_allocs;</highlight></codeline>
<codeline lineno="285"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classsrsgnb_1_1bounded__bitset" kindref="compound">prb_bitmap</ref><sp/><sp/><sp/>used_ul_crbs<sp/><sp/>=<sp/>msg3_alloc.<ref refid="structsrsgnb_1_1cell__slot__resource__allocator_1ae2c31e191e96a239397221f0a5a1ff4f" kindref="member">ul_res_grid</ref>.<ref refid="classsrsgnb_1_1cell__slot__resource__grid_1a987bac26435410ebf28670b492e71123" kindref="member">used_crbs</ref>(get_ul_bwp_cfg(),<sp/>pusch_list[puschidx].symbols);</highlight></codeline>
<codeline lineno="286"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structsrsgnb_1_1crb__interval" kindref="compound">crb_interval</ref><sp/>msg3_crbs<sp/><sp/><sp/><sp/><sp/>=<sp/><ref refid="namespacesrsgnb_1a7c24c2d559727ab4fb6e0e4db881f0b4" kindref="member">find_empty_interval_of_length</ref>(used_ul_crbs,<sp/>nof_msg3_prbs,<sp/>0);</highlight></codeline>
<codeline lineno="287"><highlight class="normal"><sp/><sp/><sp/><sp/>pusch_res_max_allocs<sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>msg3_crbs.<ref refid="classsrsgnb_1_1interval_1afaa426e56c4e96208758552d97a7b43c" kindref="member">length</ref>()<sp/>/<sp/>nof_prbs_per_msg3;</highlight></codeline>
<codeline lineno="288"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(pusch_res_max_allocs<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="289"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="290"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="291"><highlight class="normal"></highlight></codeline>
<codeline lineno="292"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>6.<sp/>Register<sp/>Msg3<sp/>allocations<sp/>for<sp/>this<sp/>PUSCH<sp/>resource<sp/>as<sp/>successful.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="293"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/>last_crb<sp/>=<sp/>msg3_crbs.start();</highlight></codeline>
<codeline lineno="294"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>pusch_res_max_allocs;<sp/>++i)<sp/>{</highlight></codeline>
<codeline lineno="295"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>msg3_candidates.emplace_back();</highlight></codeline>
<codeline lineno="296"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>msg3_candidates.back().crbs<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>{last_crb,<sp/>last_crb<sp/>+<sp/>nof_prbs_per_msg3};</highlight></codeline>
<codeline lineno="297"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>msg3_candidates.back().pusch_td_res_index<sp/>=<sp/>puschidx;</highlight></codeline>
<codeline lineno="298"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>last_crb<sp/>+=<sp/>nof_prbs_per_msg3;</highlight></codeline>
<codeline lineno="299"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="300"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="301"><highlight class="normal"><sp/><sp/>max_nof_allocs<sp/>=<sp/>msg3_candidates.size();</highlight></codeline>
<codeline lineno="302"><highlight class="normal"><sp/><sp/>rar_crbs.<ref refid="classsrsgnb_1_1interval_1a04b106d6ce5ebfe0b68bc8abe6a2f5ec" kindref="member">resize</ref>(nof_prbs_per_rar<sp/>*<sp/>max_nof_allocs);</highlight></codeline>
<codeline lineno="303"><highlight class="normal"></highlight></codeline>
<codeline lineno="304"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>7.<sp/>Find<sp/>space<sp/>in<sp/>PDCCH<sp/>for<sp/>RAR.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="305"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/><ref refid="namespacesrsgnb_1a1e0dbb8f05429dc6d5ab1311059e01c1" kindref="member">aggregation_level</ref><sp/>aggr_lvl<sp/>=<sp/>aggregation_level::n4;</highlight></codeline>
<codeline lineno="306"><highlight class="normal"><sp/><sp/><ref refid="namespacesrsgnb_1a66a5b6e7f9a3179978042eb82e981c65" kindref="member">search_space_id</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ss_id<sp/><sp/><sp/><sp/>=<sp/>cfg.dl_cfg_common.init_dl_bwp.pdcch_common.<ref refid="structsrsgnb_1_1pdcch__config__common_1ade67a3376dc53058290c2f3af227b5e3" kindref="member">ra_search_space_id</ref>;</highlight></codeline>
<codeline lineno="307"><highlight class="normal"><sp/><sp/><ref refid="structsrsgnb_1_1pdcch__dl__information" kindref="compound">pdcch_dl_information</ref>*<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pdcch<sp/><sp/><sp/><sp/>=<sp/>pdcch_sch.<ref refid="classsrsgnb_1_1pdcch__scheduler_1aa6370fabd4108388b1107c9481339c5a" kindref="member">alloc_pdcch_common</ref>(rar_alloc,<sp/>rar.ra_rnti,<sp/>ss_id,<sp/>aggr_lvl);</highlight></codeline>
<codeline lineno="308"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(pdcch<sp/>==<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="309"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="310"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="311"><highlight class="normal"></highlight></codeline>
<codeline lineno="312"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Status:<sp/>RAR<sp/>allocation<sp/>is<sp/>successful.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="313"><highlight class="normal"></highlight></codeline>
<codeline lineno="314"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>8.<sp/>Fill<sp/>RAR<sp/>and<sp/>Msg3<sp/>PDSCH,<sp/>PUSCH<sp/>and<sp/>DCI.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="315"><highlight class="normal"><sp/><sp/><ref refid="classsrsgnb_1_1ra__scheduler_1aa7f5ee78860e7768890012a950bb289c" kindref="member">fill_rar_grant</ref>(res_alloc,<sp/>rar,<sp/>rar_crbs,<sp/>msg3_candidates);</highlight></codeline>
<codeline lineno="316"><highlight class="normal"></highlight></codeline>
<codeline lineno="317"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>msg3_candidates.size();</highlight></codeline>
<codeline lineno="318"><highlight class="normal">}</highlight></codeline>
<codeline lineno="319"><highlight class="normal"></highlight></codeline>
<codeline lineno="320" refid="classsrsgnb_1_1ra__scheduler_1aa7f5ee78860e7768890012a950bb289c" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classsrsgnb_1_1ra__scheduler_1aa7f5ee78860e7768890012a950bb289c" kindref="member">ra_scheduler::fill_rar_grant</ref>(<ref refid="structsrsgnb_1_1cell__resource__allocator" kindref="compound">cell_resource_allocator</ref>&amp;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>res_alloc,</highlight></codeline>
<codeline lineno="321"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsrsgnb_1_1ra__scheduler_1_1pending__rar__t" kindref="compound">pending_rar_t</ref>&amp;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rar_request,</highlight></codeline>
<codeline lineno="322"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structsrsgnb_1_1crb__interval" kindref="compound">crb_interval</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rar_crbs,</highlight></codeline>
<codeline lineno="323"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classsrsgnb_1_1span" kindref="compound">span&lt;const msg3_alloc_candidate&gt;</ref><sp/>msg3_candidates)</highlight></codeline>
<codeline lineno="324"><highlight class="normal">{</highlight></codeline>
<codeline lineno="325"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/>max_msg3_retxs<sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>4;</highlight></codeline>
<codeline lineno="326"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/>msg3_mcs<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="327"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/>pdsch_time_res_index<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="328"><highlight class="normal"></highlight></codeline>
<codeline lineno="329"><highlight class="normal"><sp/><sp/><ref refid="structsrsgnb_1_1cell__slot__resource__allocator" kindref="compound">cell_slot_resource_allocator</ref>&amp;<sp/>pdcch_alloc<sp/>=<sp/>res_alloc[0];</highlight></codeline>
<codeline lineno="330"><highlight class="normal"><sp/><sp/><ref refid="structsrsgnb_1_1cell__slot__resource__allocator" kindref="compound">cell_slot_resource_allocator</ref>&amp;<sp/>rar_alloc<sp/><sp/><sp/>=<sp/>res_alloc[get_pdsch_cfg().<ref refid="structsrsgnb_1_1pdsch__config__common_1a9ae93edd088068b36ce29029781ed84b" kindref="member">pdsch_td_alloc_list</ref>[pdsch_time_res_index].k0];</highlight></codeline>
<codeline lineno="331"><highlight class="normal"><sp/><sp/><ref refid="structsrsgnb_1_1prb__interval" kindref="compound">prb_interval</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rar_prbs<sp/><sp/><sp/><sp/>=<sp/><ref refid="namespacesrsgnb_1adaef08fc34c2214394a362de4f1182bc" kindref="member">crb_to_prb</ref>(initial_active_dl_bwp,<sp/>rar_crbs);</highlight></codeline>
<codeline lineno="332"><highlight class="normal"></highlight></codeline>
<codeline lineno="333"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Fill<sp/>RAR<sp/>DCI.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="334"><highlight class="normal"><sp/><sp/><ref refid="structsrsgnb_1_1pdcch__dl__information" kindref="compound">pdcch_dl_information</ref>&amp;<sp/>pdcch<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>pdcch_alloc.<ref refid="structsrsgnb_1_1cell__slot__resource__allocator_1a8724d6f3f22a6c17ae31694f3b528153" kindref="member">result</ref>.dl.<ref refid="structsrsgnb_1_1dl__sched__result_1a3b8afa3e317da218903a0ce0013aecf9" kindref="member">dl_pdcchs</ref>.back();</highlight></codeline>
<codeline lineno="335"><highlight class="normal"><sp/><sp/>pdcch.<ref refid="structsrsgnb_1_1pdcch__dl__information_1aa4376bf19e46fb9eafb348de9fc6a52b" kindref="member">dci</ref>.type<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>dci_dl_rnti_config_type::ra_f1_0;</highlight></codeline>
<codeline lineno="336"><highlight class="normal"><sp/><sp/>pdcch.<ref refid="structsrsgnb_1_1pdcch__dl__information_1aa4376bf19e46fb9eafb348de9fc6a52b" kindref="member">dci</ref>.ra_f1_0<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>{};</highlight></codeline>
<codeline lineno="337"><highlight class="normal"><sp/><sp/><ref refid="structsrsgnb_1_1dci__1__0__ra__rnti__configuration" kindref="compound">dci_1_0_ra_rnti_configuration</ref>&amp;<sp/>dci<sp/>=<sp/>pdcch.<ref refid="structsrsgnb_1_1pdcch__dl__information_1aa4376bf19e46fb9eafb348de9fc6a52b" kindref="member">dci</ref>.ra_f1_0;</highlight></codeline>
<codeline lineno="338"><highlight class="normal"><sp/><sp/>dci.<ref refid="structsrsgnb_1_1dci__1__0__ra__rnti__configuration_1acba9ef194160776a49afd7feca63dca0" kindref="member">N_rb_dl_bwp</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>initial_active_dl_bwp.<ref refid="structsrsgnb_1_1bwp__configuration_1af8ceaeaae0eccfbacd463cfc855e28d1" kindref="member">crbs</ref>.<ref refid="classsrsgnb_1_1interval_1afaa426e56c4e96208758552d97a7b43c" kindref="member">length</ref>();</highlight></codeline>
<codeline lineno="339"><highlight class="normal"><sp/><sp/>dci.<ref refid="structsrsgnb_1_1dci__1__0__ra__rnti__configuration_1aae1e821d0357c41c254d1f4cd72506f0" kindref="member">frequency_resource</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/><ref refid="namespacesrsgnb_1aede2872e435490d81f52241b47f934a5" kindref="member">ra_frequency_type1_get_riv</ref>(</highlight></codeline>
<codeline lineno="340"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structsrsgnb_1_1ra__frequency__type1__configuration" kindref="compound">ra_frequency_type1_configuration</ref>{dci.<ref refid="structsrsgnb_1_1dci__1__0__ra__rnti__configuration_1acba9ef194160776a49afd7feca63dca0" kindref="member">N_rb_dl_bwp</ref>,<sp/>rar_prbs.start(),<sp/>rar_prbs.<ref refid="classsrsgnb_1_1interval_1afaa426e56c4e96208758552d97a7b43c" kindref="member">length</ref>()});</highlight></codeline>
<codeline lineno="341"><highlight class="normal"><sp/><sp/>dci.<ref refid="structsrsgnb_1_1dci__1__0__ra__rnti__configuration_1a9cf11a883c741540be4f3ad67b9a7567" kindref="member">time_resource</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>pdsch_time_res_index;</highlight></codeline>
<codeline lineno="342"><highlight class="normal"><sp/><sp/>dci.<ref refid="structsrsgnb_1_1dci__1__0__ra__rnti__configuration_1a56917eb7d59f37c3bd6d6a138d075bec" kindref="member">vrb_to_prb_mapping</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>0;<sp/></highlight><highlight class="comment">//<sp/>TODO.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="343"><highlight class="normal"><sp/><sp/>dci.<ref refid="structsrsgnb_1_1dci__1__0__ra__rnti__configuration_1ac395c86cd70487b6e58848370d5b93f6" kindref="member">modulation_coding_scheme</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="344"><highlight class="normal"><sp/><sp/>dci.<ref refid="structsrsgnb_1_1dci__1__0__ra__rnti__configuration_1a564e29c8e1a7112de70662426b7b6525" kindref="member">tb_scaling</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>0;<sp/></highlight><highlight class="comment">//<sp/>TODO.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="345"><highlight class="normal"></highlight></codeline>
<codeline lineno="346"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Allocate<sp/>RBs<sp/>and<sp/>space<sp/>for<sp/>RAR.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="347"><highlight class="normal"><sp/><sp/>rar_alloc.<ref refid="structsrsgnb_1_1cell__slot__resource__allocator_1af1df59d8b7ca78390815806e0a552d8e" kindref="member">dl_res_grid</ref>.<ref refid="classsrsgnb_1_1cell__slot__resource__grid_1abf35ef94e4fda289536095561faded14" kindref="member">fill</ref>(</highlight></codeline>
<codeline lineno="348"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structsrsgnb_1_1grant__info" kindref="compound">grant_info</ref>{get_dl_bwp_cfg().scs,<sp/>get_pdsch_cfg().<ref refid="structsrsgnb_1_1pdsch__config__common_1a9ae93edd088068b36ce29029781ed84b" kindref="member">pdsch_td_alloc_list</ref>[pdsch_time_res_index].symbols,<sp/>rar_crbs});</highlight></codeline>
<codeline lineno="349"><highlight class="normal"></highlight></codeline>
<codeline lineno="350"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Fill<sp/>RAR<sp/>PDSCH.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="351"><highlight class="normal"><sp/><sp/>rar_alloc.<ref refid="structsrsgnb_1_1cell__slot__resource__allocator_1a8724d6f3f22a6c17ae31694f3b528153" kindref="member">result</ref>.dl.<ref refid="structsrsgnb_1_1dl__sched__result_1a4fbc52d52b7913aeb1c98bde41727557" kindref="member">rar_grants</ref>.emplace_back();</highlight></codeline>
<codeline lineno="352"><highlight class="normal"><sp/><sp/><ref refid="structsrsgnb_1_1rar__information" kindref="compound">rar_information</ref>&amp;<sp/>rar<sp/><sp/>=<sp/>rar_alloc.<ref refid="structsrsgnb_1_1cell__slot__resource__allocator_1a8724d6f3f22a6c17ae31694f3b528153" kindref="member">result</ref>.dl.<ref refid="structsrsgnb_1_1dl__sched__result_1a4fbc52d52b7913aeb1c98bde41727557" kindref="member">rar_grants</ref>.back();</highlight></codeline>
<codeline lineno="353"><highlight class="normal"><sp/><sp/>rar.pdcch_cfg<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>&amp;pdcch;</highlight></codeline>
<codeline lineno="354"><highlight class="normal"><sp/><sp/>rar.pdsch_cfg.rnti<sp/><sp/><sp/><sp/>=<sp/>rar.pdcch_cfg-&gt;<ref refid="structsrsgnb_1_1pdcch__dl__information_1a0fff3781f4ea2a6c31cd8d8caf1302ad" kindref="member">ctx</ref>.<ref refid="structsrsgnb_1_1dci__dl__context__information_1a106400b42c3d9db75aafe6791fa8acfd" kindref="member">rnti</ref>;</highlight></codeline>
<codeline lineno="355"><highlight class="normal"><sp/><sp/>rar.pdsch_cfg.bwp_cfg<sp/>=<sp/>rar.pdcch_cfg-&gt;<ref refid="structsrsgnb_1_1pdcch__dl__information_1a0fff3781f4ea2a6c31cd8d8caf1302ad" kindref="member">ctx</ref>.bwp_cfg;</highlight></codeline>
<codeline lineno="356"><highlight class="normal"><sp/><sp/>rar.pdsch_cfg.prbs<sp/><sp/><sp/><sp/>=<sp/>rar_prbs;</highlight></codeline>
<codeline lineno="357"><highlight class="normal"><sp/><sp/>rar.pdsch_cfg.symbols<sp/>=<sp/>get_pdsch_cfg().<ref refid="structsrsgnb_1_1pdsch__config__common_1a9ae93edd088068b36ce29029781ed84b" kindref="member">pdsch_td_alloc_list</ref>[pdsch_time_res_index].symbols;</highlight></codeline>
<codeline lineno="358"><highlight class="normal"><sp/><sp/>rar.pdsch_cfg.codewords.emplace_back();</highlight></codeline>
<codeline lineno="359"><highlight class="normal"><sp/><sp/><ref refid="structsrsgnb_1_1pdsch__codeword" kindref="compound">pdsch_codeword</ref>&amp;<sp/>cw<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>rar.pdsch_cfg.codewords.back();</highlight></codeline>
<codeline lineno="360"><highlight class="normal"><sp/><sp/>cw.<ref refid="structsrsgnb_1_1pdsch__codeword_1a359ca9ef3e308169802b324e4c1c8296" kindref="member">mcs_table</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/><ref refid="namespacesrsgnb_1a21ef16d6a637e18275f487d9e9d6934eafe97d5927e34d78b68330ae92f2773cb" kindref="member">pdsch_mcs_table::qam64</ref>;</highlight></codeline>
<codeline lineno="361"><highlight class="normal"><sp/><sp/>cw.<ref refid="structsrsgnb_1_1pdsch__codeword_1a71ab8ab9e68f088d280d2d4f96b28091" kindref="member">mcs_index</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>dci.<ref refid="structsrsgnb_1_1dci__1__0__ra__rnti__configuration_1ac395c86cd70487b6e58848370d5b93f6" kindref="member">modulation_coding_scheme</ref>;</highlight></codeline>
<codeline lineno="362"><highlight class="normal"><sp/><sp/>cw.<ref refid="structsrsgnb_1_1pdsch__codeword_1a0ab5fcd8dc9e596260bf8809f1a2b43a" kindref="member">rv_index</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="363"><highlight class="normal"><sp/><sp/><ref refid="structsrsgnb_1_1sch__mcs__description" kindref="compound">sch_mcs_description</ref><sp/>mcs_config<sp/>=<sp/><ref refid="namespacesrsgnb_1a3e9b74a378fe34278fcb9800bad5194d" kindref="member">pdsch_mcs_get_config</ref>(cw.<ref refid="structsrsgnb_1_1pdsch__codeword_1a359ca9ef3e308169802b324e4c1c8296" kindref="member">mcs_table</ref>,<sp/>cw.<ref refid="structsrsgnb_1_1pdsch__codeword_1a71ab8ab9e68f088d280d2d4f96b28091" kindref="member">mcs_index</ref>);</highlight></codeline>
<codeline lineno="364"><highlight class="normal"><sp/><sp/>cw.<ref refid="structsrsgnb_1_1pdsch__codeword_1ab63b5e2c849b3732ecb650fd1e203cb3" kindref="member">qam_mod</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>mcs_config.<ref refid="structsrsgnb_1_1sch__mcs__description_1a27b873fa09cae4d03163fc6073c358c1" kindref="member">modulation</ref>;</highlight></codeline>
<codeline lineno="365"><highlight class="normal"><sp/><sp/>cw.<ref refid="structsrsgnb_1_1pdsch__codeword_1ad6b4fac257c496c94be162da554c7dfa" kindref="member">target_code_rate</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>mcs_config.<ref refid="structsrsgnb_1_1sch__mcs__description_1a8fb74b1f181ee52ebe29476f78f964e8" kindref="member">target_code_rate</ref>;</highlight></codeline>
<codeline lineno="366"><highlight class="normal"><sp/><sp/>cw.<ref refid="structsrsgnb_1_1pdsch__codeword_1aa8560f6d98a0f35cb27a6093b69fe67e" kindref="member">tb_size_bytes</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>0;<sp/></highlight><highlight class="comment">//<sp/>TODO</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="367"><highlight class="normal"><sp/><sp/>rar.pdsch_cfg.dmrs<sp/>=</highlight></codeline>
<codeline lineno="368"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespacesrsgnb_1a4c96541c857fc1232a058629534d341e" kindref="member">make_dmrs_info_common</ref>(cfg.dl_cfg_common.init_dl_bwp.pdsch_common,<sp/>dci.<ref refid="structsrsgnb_1_1dci__1__0__ra__rnti__configuration_1a9cf11a883c741540be4f3ad67b9a7567" kindref="member">time_resource</ref>,<sp/>cfg.pci,<sp/>cfg.dmrs_typeA_pos);</highlight></codeline>
<codeline lineno="369"><highlight class="normal"></highlight></codeline>
<codeline lineno="370"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>msg3_candidates.<ref refid="classsrsgnb_1_1span_1a6408cc7b1d5db1eac20b53b8eaa5188e" kindref="member">size</ref>();<sp/>++i)<sp/>{</highlight></codeline>
<codeline lineno="371"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal">&amp;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>msg3_candidate<sp/>=<sp/>msg3_candidates[i];</highlight></codeline>
<codeline lineno="372"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal">&amp;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pusch_res<sp/><sp/>=<sp/>get_pusch_cfg().<ref refid="structsrsgnb_1_1pusch__config__common_1a605245abaef61a7bf04b5ff774e7f0b9" kindref="member">pusch_td_alloc_list</ref>[msg3_candidate.pusch_td_res_index];</highlight></codeline>
<codeline lineno="373"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>msg3_delay<sp/>=<sp/><ref refid="namespacesrsgnb_1a890506b2184eacc8a9091b7349eda0bf" kindref="member">get_msg3_delay</ref>(pusch_res,<sp/>get_ul_bwp_cfg().scs);</highlight></codeline>
<codeline lineno="374"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structsrsgnb_1_1cell__slot__resource__allocator" kindref="compound">cell_slot_resource_allocator</ref>&amp;<sp/>msg3_alloc<sp/>=<sp/>res_alloc[msg3_delay];</highlight></codeline>
<codeline lineno="375"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structsrsgnb_1_1prb__interval" kindref="compound">prb_interval</ref><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>prbs<sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/><ref refid="namespacesrsgnb_1adaef08fc34c2214394a362de4f1182bc" kindref="member">crb_to_prb</ref>(get_ul_bwp_cfg(),<sp/>msg3_candidate.<ref refid="structsrsgnb_1_1bwp__configuration_1af8ceaeaae0eccfbacd463cfc855e28d1" kindref="member">crbs</ref>);</highlight></codeline>
<codeline lineno="376"><highlight class="normal"></highlight></codeline>
<codeline lineno="377"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal">&amp;<sp/><ref refid="structsrsgnb_1_1ra__scheduler_1_1pending__msg3" kindref="compound">pending_msg3</ref><sp/>=<sp/>pending_msg3s[rar_request.tc_rntis[i]<sp/>%<sp/><ref refid="classsrsgnb_1_1ra__scheduler_1adbf15d9756db8db431a332414711b3b4" kindref="member">MAX_NOF_MSG3</ref>];</highlight></codeline>
<codeline lineno="378"><highlight class="normal"><sp/><sp/><sp/><sp/>srsgnb_sanity_check(<ref refid="structsrsgnb_1_1ra__scheduler_1_1pending__msg3" kindref="compound">pending_msg3</ref>.<ref refid="structsrsgnb_1_1ra__scheduler_1_1pending__msg3_1a532255393e9e615ed1d5c34b2defda69" kindref="member">harq</ref>.<ref refid="classsrsgnb_1_1harq__process_1af540d4e4b2a5da1f6bf200b0bdd500db" kindref="member">empty</ref>(),<sp/></highlight><highlight class="stringliteral">&quot;Pending<sp/>Msg3<sp/>should<sp/>not<sp/>have<sp/>been<sp/>added<sp/>if<sp/>HARQ<sp/>is<sp/>busy.&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="379"><highlight class="normal"></highlight></codeline>
<codeline lineno="380"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Add<sp/>MAC<sp/>SDU<sp/>with<sp/>UL<sp/>grant<sp/>(Msg3)<sp/>in<sp/>RAR<sp/>PDU.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="381"><highlight class="normal"><sp/><sp/><sp/><sp/>rar.grants.emplace_back();</highlight></codeline>
<codeline lineno="382"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structsrsgnb_1_1rar__ul__grant" kindref="compound">rar_ul_grant</ref>&amp;<sp/>msg3_info<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>rar.grants.back();</highlight></codeline>
<codeline lineno="383"><highlight class="normal"><sp/><sp/><sp/><sp/>msg3_info.rapid<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/><ref refid="structsrsgnb_1_1ra__scheduler_1_1pending__msg3" kindref="compound">pending_msg3</ref>.ind_msg.preamble_id;</highlight></codeline>
<codeline lineno="384"><highlight class="normal"><sp/><sp/><sp/><sp/>msg3_info.ta<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/><ref refid="structsrsgnb_1_1ra__scheduler_1_1pending__msg3" kindref="compound">pending_msg3</ref>.ind_msg.timing_advance.<ref refid="classsrsgnb_1_1phy__time__unit_1a61391ed7d44d3aae421439e8aad97e39" kindref="member">to_Ta</ref>(get_ul_bwp_cfg().scs);</highlight></codeline>
<codeline lineno="385"><highlight class="normal"><sp/><sp/><sp/><sp/>msg3_info.temp_crnti<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/><ref refid="structsrsgnb_1_1ra__scheduler_1_1pending__msg3" kindref="compound">pending_msg3</ref>.ind_msg.crnti;</highlight></codeline>
<codeline lineno="386"><highlight class="normal"><sp/><sp/><sp/><sp/>msg3_info.time_resource_assignment<sp/>=<sp/>msg3_candidate.pusch_td_res_index;</highlight></codeline>
<codeline lineno="387"><highlight class="normal"><sp/><sp/><sp/><sp/>msg3_info.freq_resource_assignment<sp/>=<sp/><ref refid="namespacesrsgnb_1aede2872e435490d81f52241b47f934a5" kindref="member">ra_frequency_type1_get_riv</ref>(<ref refid="structsrsgnb_1_1ra__frequency__type1__configuration" kindref="compound">ra_frequency_type1_configuration</ref>{</highlight></codeline>
<codeline lineno="388"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>cfg.ul_cfg_common.init_ul_bwp.generic_params.<ref refid="structsrsgnb_1_1bwp__configuration_1af8ceaeaae0eccfbacd463cfc855e28d1" kindref="member">crbs</ref>.<ref refid="classsrsgnb_1_1interval_1afaa426e56c4e96208758552d97a7b43c" kindref="member">length</ref>(),<sp/>prbs.start(),<sp/>prbs.<ref refid="classsrsgnb_1_1interval_1afaa426e56c4e96208758552d97a7b43c" kindref="member">length</ref>()});</highlight></codeline>
<codeline lineno="389"><highlight class="normal"><sp/><sp/><sp/><sp/>msg3_info.mcs<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="390"><highlight class="normal"><sp/><sp/><sp/><sp/>msg3_info.tpc<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="391"><highlight class="normal"><sp/><sp/><sp/><sp/>msg3_info.csi_req<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="392"><highlight class="normal"></highlight></codeline>
<codeline lineno="393"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Allocate<sp/>Msg3<sp/>RBs.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="394"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsrsgnb_1_1ofdm__symbol__range" kindref="compound">ofdm_symbol_range</ref>&amp;<sp/>symbols<sp/>=<sp/>get_pusch_cfg().<ref refid="structsrsgnb_1_1pusch__config__common_1a605245abaef61a7bf04b5ff774e7f0b9" kindref="member">pusch_td_alloc_list</ref>[msg3_candidate.pusch_td_res_index].symbols;</highlight></codeline>
<codeline lineno="395"><highlight class="normal"><sp/><sp/><sp/><sp/>msg3_alloc.<ref refid="structsrsgnb_1_1cell__slot__resource__allocator_1ae2c31e191e96a239397221f0a5a1ff4f" kindref="member">ul_res_grid</ref>.<ref refid="classsrsgnb_1_1cell__slot__resource__grid_1abf35ef94e4fda289536095561faded14" kindref="member">fill</ref>(<ref refid="structsrsgnb_1_1grant__info" kindref="compound">grant_info</ref>{get_dl_bwp_cfg().scs,<sp/>symbols,<sp/>msg3_candidate.crbs});</highlight></codeline>
<codeline lineno="396"><highlight class="normal"><sp/><sp/><sp/><sp/>msg3_alloc.<ref refid="structsrsgnb_1_1cell__slot__resource__allocator_1a8724d6f3f22a6c17ae31694f3b528153" kindref="member">result</ref>.ul.<ref refid="structsrsgnb_1_1ul__sched__result_1ac88b1e019615e31f6add6d928d7bf464" kindref="member">puschs</ref>.emplace_back();</highlight></codeline>
<codeline lineno="397"><highlight class="normal"></highlight></codeline>
<codeline lineno="398"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Fill<sp/>PUSCH<sp/>for<sp/>Msg3.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="399"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structsrsgnb_1_1ul__sched__info" kindref="compound">ul_sched_info</ref>&amp;<sp/>pusch<sp/><sp/><sp/><sp/>=<sp/>msg3_alloc.<ref refid="structsrsgnb_1_1cell__slot__resource__allocator_1a8724d6f3f22a6c17ae31694f3b528153" kindref="member">result</ref>.ul.<ref refid="structsrsgnb_1_1ul__sched__result_1ac88b1e019615e31f6add6d928d7bf464" kindref="member">puschs</ref>.back();</highlight></codeline>
<codeline lineno="400"><highlight class="normal"><sp/><sp/><sp/><sp/>pusch.crnti<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/><ref refid="structsrsgnb_1_1ra__scheduler_1_1pending__msg3" kindref="compound">pending_msg3</ref>.ind_msg.crnti;</highlight></codeline>
<codeline lineno="401"><highlight class="normal"><sp/><sp/><sp/><sp/>pusch.pusch_cfg.bwp_cfg<sp/>=<sp/>&amp;get_ul_bwp_cfg();</highlight></codeline>
<codeline lineno="402"><highlight class="normal"><sp/><sp/><sp/><sp/>pusch.pusch_cfg.prbs<sp/><sp/><sp/><sp/>=<sp/>prbs;</highlight></codeline>
<codeline lineno="403"><highlight class="normal"><sp/><sp/><sp/><sp/>pusch.pusch_cfg.symbols<sp/>=<sp/>symbols;</highlight></codeline>
<codeline lineno="404"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>TODO</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="405"><highlight class="normal"></highlight></codeline>
<codeline lineno="406"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Allocate<sp/>Msg3<sp/>UL<sp/>HARQ</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="407"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>success<sp/>=<sp/><ref refid="structsrsgnb_1_1ra__scheduler_1_1pending__msg3" kindref="compound">pending_msg3</ref>.<ref refid="structsrsgnb_1_1ra__scheduler_1_1pending__msg3_1a532255393e9e615ed1d5c34b2defda69" kindref="member">harq</ref>.<ref refid="classsrsgnb_1_1ul__harq__process_1adf213efc4c2782c0320adaf717a2ac39" kindref="member">new_tx</ref>(msg3_alloc.<ref refid="structsrsgnb_1_1cell__slot__resource__allocator_1a05be11a3c949d1b681c5221c7254c79d" kindref="member">slot</ref>,<sp/>prbs,<sp/>msg3_mcs,<sp/>max_msg3_retxs);</highlight></codeline>
<codeline lineno="408"><highlight class="normal"><sp/><sp/><sp/><sp/>srsgnb_sanity_check(success,<sp/></highlight><highlight class="stringliteral">&quot;Unexpected<sp/>HARQ<sp/>allocation<sp/>return&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="409"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="410"><highlight class="normal">}</highlight></codeline>
<codeline lineno="411"><highlight class="normal"></highlight></codeline>
<codeline lineno="412"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>ra_scheduler::log_postponed_rar(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>pending_rar_t&amp;<sp/>rar,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal">*<sp/>cause_str)</highlight><highlight class="keyword"><sp/>const</highlight></codeline>
<codeline lineno="413"><highlight class="keyword"></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="414"><highlight class="normal"><sp/><sp/>logger.debug(</highlight><highlight class="stringliteral">&quot;SCHED:<sp/>RAR<sp/>allocation<sp/>for<sp/>ra-rnti={}<sp/>was<sp/>postponed.<sp/>Cause:<sp/>{}&quot;</highlight><highlight class="normal">,<sp/>rar.ra_rnti,<sp/>cause_str);</highlight></codeline>
<codeline lineno="415"><highlight class="normal">}</highlight></codeline>
<codeline lineno="416"><highlight class="normal"></highlight></codeline>
<codeline lineno="418" refid="classsrsgnb_1_1ra__scheduler_1a94702d805bb68afd2e7b87e0cd192ba2" refkind="member"><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classsrsgnb_1_1ra__scheduler_1a94702d805bb68afd2e7b87e0cd192ba2" kindref="member">ra_scheduler::log_rar_helper</ref>(fmt::memory_buffer&amp;<sp/>fmtbuf,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsrsgnb_1_1rar__information" kindref="compound">rar_information</ref>&amp;<sp/>rar)</highlight><highlight class="keyword"><sp/>const</highlight></codeline>
<codeline lineno="419"><highlight class="keyword"></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="420"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal">*<sp/>prefix<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="421"><highlight class="normal"><sp/><sp/>fmt::format_to(fmtbuf,<sp/></highlight><highlight class="stringliteral">&quot;ra-rnti={:#x},<sp/>msg3s=[&quot;</highlight><highlight class="normal">,<sp/>rar.pdcch_cfg-&gt;<ref refid="structsrsgnb_1_1pdcch__dl__information_1a0fff3781f4ea2a6c31cd8d8caf1302ad" kindref="member">ctx</ref>.<ref refid="structsrsgnb_1_1dci__dl__context__information_1a106400b42c3d9db75aafe6791fa8acfd" kindref="member">rnti</ref>);</highlight></codeline>
<codeline lineno="422"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsrsgnb_1_1rar__ul__grant" kindref="compound">rar_ul_grant</ref>&amp;<sp/>msg3<sp/>:<sp/>rar.grants)<sp/>{</highlight></codeline>
<codeline lineno="423"><highlight class="normal"><sp/><sp/><sp/><sp/>fmt::format_to(fmtbuf,</highlight></codeline>
<codeline lineno="424"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;{}{{{:#x}:<sp/>rapid={},<sp/>prbs={},<sp/>ta={}}}&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="425"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>prefix,</highlight></codeline>
<codeline lineno="426"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>msg3.temp_crnti,</highlight></codeline>
<codeline lineno="427"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>msg3.rapid,</highlight></codeline>
<codeline lineno="428"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pending_msg3s[msg3.temp_crnti<sp/>%<sp/><ref refid="classsrsgnb_1_1ra__scheduler_1adbf15d9756db8db431a332414711b3b4" kindref="member">MAX_NOF_MSG3</ref>].harq.prbs().prbs(),</highlight></codeline>
<codeline lineno="429"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>msg3.ta);</highlight></codeline>
<codeline lineno="430"><highlight class="normal"><sp/><sp/><sp/><sp/>prefix<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;,<sp/>&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="431"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="432"><highlight class="normal"><sp/><sp/>fmt::format_to(fmtbuf,<sp/></highlight><highlight class="stringliteral">&quot;]&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="433"><highlight class="normal">}</highlight></codeline>
<codeline lineno="434"><highlight class="normal"></highlight></codeline>
<codeline lineno="435"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>ra_scheduler::log_rars(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsrsgnb_1_1cell__resource__allocator" kindref="compound">cell_resource_allocator</ref>&amp;<sp/>res_alloc)</highlight><highlight class="keyword"><sp/>const</highlight></codeline>
<codeline lineno="436"><highlight class="keyword"></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="437"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(not<sp/>logger.info.enabled())<sp/>{</highlight></codeline>
<codeline lineno="438"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="439"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="440"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">auto</highlight><highlight class="normal">&amp;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rar_alloc<sp/>=<sp/>res_alloc[0];</highlight></codeline>
<codeline lineno="441"><highlight class="normal"><sp/><sp/><ref refid="classsrsgnb_1_1span" kindref="compound">span&lt;const rar_information&gt;</ref><sp/>rars<sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>rar_alloc.result.dl.rar_grants;</highlight></codeline>
<codeline lineno="442"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(rars.<ref refid="classsrsgnb_1_1span_1a595cf1b0fe0385603307ba67012f820c" kindref="member">empty</ref>())<sp/>{</highlight></codeline>
<codeline lineno="443"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="444"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="445"><highlight class="normal"></highlight></codeline>
<codeline lineno="446"><highlight class="normal"><sp/><sp/>fmt::memory_buffer<sp/>fmtbuf;</highlight></codeline>
<codeline lineno="447"><highlight class="normal"><sp/><sp/>fmt::format_to(fmtbuf,<sp/></highlight><highlight class="stringliteral">&quot;SCHED:<sp/>RAR,<sp/>cell={}<sp/>({}<sp/>allocated):&quot;</highlight><highlight class="normal">,<sp/>cfg.cell_index,<sp/>rars.<ref refid="classsrsgnb_1_1span_1a6408cc7b1d5db1eac20b53b8eaa5188e" kindref="member">size</ref>());</highlight></codeline>
<codeline lineno="448"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structsrsgnb_1_1rar__information" kindref="compound">rar_information</ref>&amp;<sp/>rar<sp/>:<sp/>rars)<sp/>{</highlight></codeline>
<codeline lineno="449"><highlight class="normal"><sp/><sp/><sp/><sp/>fmt::format_to(fmtbuf,<sp/></highlight><highlight class="stringliteral">&quot;\n-<sp/>&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="450"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classsrsgnb_1_1ra__scheduler_1a94702d805bb68afd2e7b87e0cd192ba2" kindref="member">log_rar_helper</ref>(fmtbuf,<sp/>rar);</highlight></codeline>
<codeline lineno="451"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="452"><highlight class="normal"><sp/><sp/>logger.info(</highlight><highlight class="stringliteral">&quot;{}&quot;</highlight><highlight class="normal">,<sp/>to_c_str(fmtbuf));</highlight></codeline>
<codeline lineno="453"><highlight class="normal">}</highlight></codeline>
    </programlisting>
    <location file="lib/scheduler/common_scheduling/ra_scheduler.cpp"/>
  </compounddef>
</doxygen>
